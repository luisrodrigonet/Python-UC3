# 12.02.04 : ü§ñ Personalizar modelos dentro da aplica√ß√£o admin

Agora que voc√™ j√° sabe como registrar seus modelos na √°rea administrativa, vamos mergulhar no pr√≥ximo n√≠vel: a personaliza√ß√£o. A interface padr√£o do admin √© funcional, mas podemos torn√°-la muito mais informativa, poderosa e f√°cil de usar.

Faremos isso utilizando as classes **`ModelAdmin`**, que s√£o o centro de controle para a apar√™ncia e o comportamento de cada modelo no admin do Django.

Este material ir√° gui√°-lo, passo a passo, na personaliza√ß√£o extensiva dos seus modelos, transformando sua √°rea administrativa em uma ferramenta de gest√£o profissional.

### üé® Classe `ModelAdmin`?

Imagine que `**admin.site.register(MeuModelo)`** √© como colocar um carro b√°sico na sua garagem. Ele funciona, te leva do ponto A ao B. A classe **`ModelAdmin`** √© o painel de personaliza√ß√£o que permite adicionar rodas de liga leve, um sistema de som potente, GPS e bancos de couro.

Em termos t√©cnicos, uma **`ModelAdmin`** √© uma classe Python onde voc√™ define todas as configura√ß√µes de como um modelo espec√≠fico deve ser exibido na interface de administra√ß√£o. 

> üéØ Em vez de registrar o modelo diretamente, voc√™ registra o modelo *junto* com sua classe de personaliza√ß√£o.

#### üß© **A Nova Forma de Registrar Modelos**

At√© agora, fizemos isso:

```python
admin.site.register(Produto)
```

Agora, faremos assim:

:one:Crie uma classe de personaliza√ß√£o
```python

class ProdutoAdmin(admin.ModelAdmin):
    # ... aqui v√£o nossas configura√ß√µes ...
    pass
```
:two: Registre o modelo junto com a classe
```python
admin.site.register(Produto, ProdutoAdmin)
```

Uma maneira ainda mais moderna e recomendada de fazer isso √© usando um "decorator", que √© um atalho do Python. Ele faz a mesma coisa, mas de forma mais elegante:

```python
@admin.register(Produto)
class ProdutoAdmin(admin.ModelAdmin):
    # ... aqui v√£o nossas configura√ß√µes ...
    pass
```

Neste material, usaremos a abordagem com o decorator **`@admin.register()`** por ser mais limpa e moderna.

### üì¶ Personalizando a Visualiza√ß√£o de Produtos (`produtos/admin.py`)

Vamos aprimorar a administra√ß√£o de **`Produto`** para exibir informa√ß√µes √∫teis na lista, adicionar filtros e uma barra de busca.

Abra o arquivo **`produtos/admin.py`**. Vamos modificar o registro do modelo **`Produto`**.

#### :one: **Exibindo Mais Colunas com `list_display`**

Por padr√£o, a lista de produtos mostra apenas o nome de cada um (o resultado do m√©todo `__str__`). Vamos adicionar colunas para categoria, pre√ßo, estoque e se est√° dispon√≠vel.

#### :two: **Adicionando Filtros com `list_filter`**

Seria √∫til poder filtrar a lista de produtos rapidamente, por exemplo, para ver apenas os dispon√≠veis ou apenas os de uma certa categoria. √â para isso que serve o **`list_filter`**.

#### :three: **Habilitando a Busca com `search_fields`**

Se a sua loja tiver centenas de produtos, rolar a lista n√£o √© pr√°tico. Vamos adicionar uma barra de busca para encontrar produtos pelo nome ou pela descri√ß√£o.

**Aplicando as Mudan√ßas em `produtos/admin.py`**

Substitua o conte√∫do do seu **`produtos/admin.py`** pelo c√≥digo abaixo, que aplica todas essas melhorias:

```python
# produtos/admin.py
from django.contrib import admin
from .models import Categoria, Produto

# Mantemos o registro simples para Categoria, pois n√£o precisa de personaliza√ß√£o
admin.site.register(Categoria)


# Usamos o decorator @admin.register para registrar e personalizar o modelo Produto
@admin.register(Produto)
class ProdutoAdmin(admin.ModelAdmin):
    """
    Personaliza√ß√£o da exibi√ß√£o do modelo Produto na interface de administra√ß√£o.
    """
    
    # list_display define as colunas que aparecer√£o na lista de produtos.
    # Podemos incluir campos do modelo e at√© mesmo de modelos relacionados (ForeignKey).
    list_display = ('nome', 'categoria', 'preco', 'estoque', 'disponivel')
    
    # list_filter cria uma barra lateral com op√ß√µes de filtro.
    # Ideal para campos com escolhas definidas, booleanos ou chaves estrangeiras.
    list_filter = ('disponivel', 'categoria')
    
    # search_fields adiciona um campo de busca no topo da lista.
    # Ele buscar√° nos campos que voc√™ especificar. O '^' busca pelo in√≠cio da palavra,
    # o '=' busca pelo valor exato e o '@' por texto completo. Por padr√£o √© 'icontains'.
    search_fields = ('nome', 'descricao')

```

üéØ **Resultado:** 
- Ao acessar a lista de produtos no `admin`, voc√™ agora ver√° m√∫ltiplas colunas, uma barra de filtros √† direita e uma caixa de busca no topo. 


### üìñ Gest√£o de Contatos (`site_loja/admin.py`)

Agora, vamos para a aplica√ß√£o **`site_loja`**. Nossa primeira tarefa √© facilitar a busca por mensagens de contato espec√≠ficas.

Abra o arquivo **`site_loja/admin.py`**.

#### ‚öôÔ∏è **Personalizando o Modelo `Contato`**

Para o modelo **`Contato`**, a funcionalidade mais importante √© poder buscar rapidamente por uma mensagem e ver quais j√° foram lidas.

```python
# Dentro de site_loja/admin.py

@admin.register(Contato)
class ContatoAdmin(admin.ModelAdmin):
    """
    Personaliza√ß√£o da exibi√ß√£o do modelo Contato.
    """
    
    # list_display para ver rapidamente as informa√ß√µes essenciais
    list_display = ('nome', 'email', 'assunto', 'data_criacao', 'lido')
    
    # search_fields para encontrar uma mensagem pelo nome, email ou assunto
    search_fields = ('nome', 'email', 'assunto')
    
    # list_filter para separar mensagens lidas das n√£o lidas
    list_filter = ('lido', 'data_criacao')
```

### üõí Detalhando Compras com Itens Embutidos (`inlines`)

Esta √© uma das personaliza√ß√µes mais poderosas. Ao visualizar uma **`Compra`** no **admin**, n√£o seria √≥timo ver e editar os **`ItemCompra`** associados a ela na mesma p√°gina? √â exatamente isso que os **`inlines`** fazem.

Eles s√£o perfeitos para rela√ß√µes de um-para-muitos (como uma **`Compra`** que tem muitos **`ItemCompra`**).

#### :one: **Criando a Classe Inline**

Primeiro, criamos uma classe que define como os **`ItemCompra`** ser√£o exibidos "dentro" da **`Compra`**. Existem dois tipos principais: `admin.TabularInline` (mostra os itens em formato de tabela, ideal para listas) e **`admin.StackedInline`** (mostra cada item em seu pr√≥prio bloco de formul√°rio). Para itens de compra, a vis√£o tabular √© perfeita.

#### :two: **Adicionando o `Inline` √† `CompraAdmin`**

Depois de definir o `inline`, n√≥s o anexamos √† classe **`CompraAdmin`** usando a op√ß√£o **`inlines`**.

üéØ **Aplicando as Mudan√ßas em `site_loja/admin.py`**

Adicione o seguinte c√≥digo ao seu **`site_loja/admin.py`**:

```python
# Dentro de site_loja/admin.py

# Criamos uma classe Inline para ItemCompra (Aula 12.02.04)
class ItemCompraInline(admin.TabularInline):
    """
    Define o formato de exibi√ß√£o dos Itens de Compra dentro da p√°gina de Compra.
    TabularInline exibe os itens em um formato de tabela compacto.
    """
    model = ItemCompra  # O modelo que ser√° exibido
    extra = 1  # Quantos formul√°rios em branco para novos itens ser√£o exibidos

#  (Aula 12.02.04)
@admin.register(Compra)
class CompraAdmin(admin.ModelAdmin):
    """
    Personaliza√ß√£o da exibi√ß√£o do modelo Compra.
    """
    list_display = ('id', 'cliente', 'data_compra', 'status', 'valor_total')
    list_filter = ('status', 'data_compra')
    search_fields = ('cliente__username', 'id')
    
    # Adicionamos o inline definido acima √† p√°gina de administra√ß√£o de Compra
    inlines = [ItemCompraInline]

    def valor_total(self, obj):
        """
        Um m√©todo customizado para exibir o valor total da compra na lista.
        """
        return f"R$ {obj.get_total()}"
    
    # Define um nome amig√°vel para a coluna no admin
    valor_total.short_description = 'Total da Compra'
```

üéØ **Resultado:** 
- Agora, quando voc√™ clicar para editar uma compra, ver√° uma tabela na parte inferior da p√°gina listando todos os `ItemCompra` associados. 
- Voc√™ pode editar os itens existentes ou adicionar novos diretamente dali.

### üìë C√≥digos Finais Completos

Para sua refer√™ncia, aqui est√£o os arquivos **`admin.py`** completos ap√≥s todas as nossas modifica√ß√µes.

:one: **`produtos/admin.py`**

```python
from django.contrib import admin
from .models import Categoria, Produto

admin.site.register(Categoria)

@admin.register(Produto)
class ProdutoAdmin(admin.ModelAdmin):
    list_display = ('nome', 'categoria', 'preco', 'estoque', 'disponivel')
    list_filter = ('disponivel', 'categoria')
    search_fields = ('nome', 'descricao')
```

:two: **`site_loja/admin.py`**

```python
from django.contrib import admin
from .models import Perfil, Contato, Comentario, Compra, ItemCompra

# Modelos com registro simples
admin.site.register(Perfil)
admin.site.register(Comentario)

@admin.register(Contato)
class ContatoAdmin(admin.ModelAdmin):
    list_display = ('nome', 'email', 'assunto', 'data_envio', 'lido')
    search_fields = ('nome', 'email', 'assunto')
    list_filter = ('lido', 'data_envio')


class ItemCompraInline(admin.TabularInline):
    model = ItemCompra
    extra = 1

@admin.register(Compra)
class CompraAdmin(admin.ModelAdmin):
    list_display = ('id', 'cliente', 'data_compra', 'status', 'valor_total')
    list_filter = ('status', 'data_compra')
    search_fields = ('cliente__username', 'id')
    inlines = [ItemCompraInline]

    def valor_total(self, obj):
        return f"R$ {obj.get_total()}"
    
    valor_total.short_description = 'Total da Compra'

# Note que ItemCompra n√£o √© registrado separadamente, pois j√° o gerenciamos via 'inlines'.
# Se quiser gerenci√°-lo de forma independente tamb√©m, basta adicionar:
# admin.site.register(ItemCompra)
```

### ‚ú® Conclus√£o

Com este passos aumentamos a qualidade da √°rea administrativa. Usando as classes `ModelAdmin`,  transformamos uma interface b√°sica em um painel de controle robusto, intuitivo e perfeitamente adaptado √†s necessidades do projeto.

O que voc√™ aprendeu aqui (`list_display`, `list_filter`, `search_fields` e `inlines`) representa 80% das personaliza√ß√µes que voc√™ usar√° no dia a dia. Encorajo voc√™ a explorar a [documenta√ß√£o oficial do Django sobre o ModelAdmin](https://www.google.com/search?q=https://docs.djangoproject.com/en/stable/ref/contrib/admin/%23modeladmin-options) para descobrir outras op√ß√µes incr√≠veis como `fieldsets`, `readonly_fields` e muito mais.