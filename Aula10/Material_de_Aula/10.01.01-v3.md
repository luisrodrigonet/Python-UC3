## 10.01.01 : 🧠 Otimizando suas Páginas Django com Partials e Blocos

No desenvolvimento web, especialmente com `Django`, é muito comum termos elementos que se repetem em várias páginas, como o cabeçalho (`header`), o rodapé (`footer`) ou até mesmo barras de navegação. Sem uma estratégia, você acabaria copiando e colando esse código em cada arquivo HTML, o que é um pesadelo para a manutenção. Se precisar mudar uma coisinha no `header`, teria que alterar em todos os arquivos\!

É aí que entram os **partials** (também chamados de includes ou pedaços de `template`) e os **blocos**. Eles são ferramentas poderosas que o `Django` nos oferece para organizar o código HTML, evitar repetição e, consequentemente, aumentar a **manutenibilidade** do seu projeto.

### 🎯 Por que usar Partials e Blocos?

  * **Reutilização de Código:** 
    - Evite copiar e colar. Escreva o código uma vez e reutilize-o em diversas páginas.
    
  * **Manutenibilidade:** 
    - Faça alterações em um único lugar e elas se refletirão em todas as páginas que utilizam aquele partial ou bloco.
    
  * **Organização:** 
    - Divida seus templates em arquivos menores e mais específicos, tornando o código mais legível e fácil de navegar.
    
  * **Colaboração:** 
    - Facilita o trabalho em equipe, já que diferentes desenvolvedores podem trabalhar em partes diferentes do template sem conflitos.

### 🎯 Entendendo o Projeto `core`

Usaremos como base o  projeto `core`, que já possui as aplicações `produtos` e `site_loja`. Focaremos na aplicação `site_loja`, que já tem uma página `home` e uma página para listar `produtos`.

Atualmente, sua aplicação `site_loja` já usa `templates` e `partials`, mas não o conceito de blocos. 

## :one: Melhorando o Uso de Partials

Os Partials são arquivos de `template` menores que contêm pedaços de código HTML que podem ser incluídos em outros `templates`. Pense neles como "componentes" reutilizáveis.

### 🧾 Armazenando os partials

É uma boa prática criar uma pasta dedicada para seus partials. Dentro da sua aplicação **`site_loja`**, você pode criar uma pasta **`templates/site_loja/partials`**.

Por exemplo, a estrutura ficaria assim:

```
core/
├── site_loja/
│   ├── templates/
│   │   ├── site_loja/
│   │   │   ├── partials/
│   │   │   │   ├── _header.html
│   │   │   │   ├── _footer.html
│   │   │   │   └── _navbar.html
│   │   │   ├── home.html
│   │   │   ├── listar_produtos.html
│   │   │   └── base.html  <-- Vamos criar este em breve!
│   ├── views.py
│   └── urls.py
└── produtos/
    └── ...
```

**Dica:** É comum prefixar os nomes dos arquivos de partials com um underscore (**`_`**) (ex: **`_header.html`**) para indicar que eles são arquivos "parciais" e não templates de página completos que serão renderizados diretamente.

### 🧾 Declarando e Usando um Partial

Para incluir um partial em seu template principal, você usa a **`tag`** de template **`{% include %}`** do Django.

Vamos imaginar que você tem um arquivo **`_header.html`** dentro de **`site_loja/templates/site_loja/partials/`** com o seguinte conteúdo:

```html
<header class="bg-dark text-white text-center py-3">
    <h1>Papagaio's - Loja Online</h1>
</header>
```

Agora, para usar este partial em seu `home.html`, você faria o seguinte:

```python
{% extends 'site_loja/base.html' %}

{% block title %}Página Inicial - Minha Loja{% endblock %}

{% block content %}

    {% include 'site_loja/partials/_header.html' %}

    <p>Explore nossos produtos incríveis.</p>
    
{% endblock %}
```

E o mesmo para **`produtos_lista.html`**:

```html
{% extends 'site_loja/base.html' %}

{% block title %}Nossos Produtos - Minha Loja{% endblock %}

{% block content %}

    {% include 'site_loja/partials/_header.html' %}

    <h1>Nossos Produtos</h1>
    <div class="row">
        {% for produto in produtos %}
            <div class="col-md-4 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">{{ produto.nome }}</h5>
                        <p class="card-text">R$ {{ produto.preco|floatformat:2 }}</p>
                        <a href="#" class="btn btn-primary">Ver Detalhes</a>
                    </div>
                </div>
            </div>
        {% empty %}
            <p>Nenhum produto encontrado.</p>
        {% endfor %}
    </div>
{% endblock %}
```

💡 **Observação:** A string **`'site_loja/partials/_header.html'`** é o **caminho relativo** do template, começando da pasta `templates` que o Django procura.

Com isso, se você precisar mudar o título do seu `header` ou adicionar um logo, fará a alteração apenas em `_header.html`, e todas as páginas que o incluem serão automaticamente atualizadas. Já é uma grande melhoria\!

## :two: Dominando os Blocos com Herança de Templates

Enquanto partials são ótimos para incluir pedaços de HTML, os **blocos** elevam a organização a um novo nível, introduzindo o conceito de **herança de templates**. Com herança, você define um template "pai" (ou base) que contém a estrutura geral da sua página e áreas "blocos" que podem ser preenchidas ou sobrescritas por templates "filhos".

Pense na herança como um formulário pré-preenchido. O formulário base (template pai) já tem campos padrão, mas você pode preencher campos específicos (blocos) em cada cópia do formulário (template filho).

### 📌 Revisando o Template Base (`base.html`)

Vamos ajustar o template base que conterá toda a estrutura comum das suas páginas, incluindo os **partials** que já definimos.

Crie um arquivo **`base.html`** dentro de **`site_loja/templates/site_loja/`**.

```html
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <!-- Block title -->
    <title>{% block title %}Papagaio's -  Loja Online{% endblock %}</title>

    <!-- Bloco extra_css -->
    {% block extra_css %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
        rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
        crossorigin="anonymous">
    {% endblock %}
    <!-- Bloco extra_css -->


</head>

<body>

    <!-- Partial - _navbar.html -->
    {% include 'site_loja/partials/_navbar.html' %}


    <main class="container mt-4">

        <!-- Bloco - content -->
        {% block content %}
        {% endblock %}
        <!-- Bloco - content -->

    </main>

    <!-- Partial - _footer.html -->
    {% include 'site_loja/partials/_footer.html' %}
    

    <!-- Bloco - extra_js -->
    {% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIh7/8yUq2p3I4k64bB" 
        crossorigin="anonymous">
    </script>
    {% endblock %}
    <!-- Bloco - extra_js -->

</body>
</html>
```

### 📌 Entendendo as Tags de Bloco

  * **`{% block nome_do_bloco %}`**: 
    - Inicia a definição de um bloco. 
    - O `nome_do_bloco` deve ser único dentro do template pai.
    
  * **`{% endblock %}`**: Fecha o bloco.

No **`base.html`**, definimos os blocos principais:

1.  **`title`**: 
    - Para o título da página na aba do navegador. 
    - Tem um valor padrão "Minha Loja Online".
    
2.  **`extra_css`**: 
    - Para incluir links CSS específicos que uma página filha possa precisar (além do Bootstrap global).
    
3.  **`content`**: 
    - Este é o bloco mais importante, onde o conteúdo exclusivo de cada página será inserido.
    
4.  **`extra_js`**: 
    - Para incluir scripts JavaScript específicos.

### 📌 Modificando Templates Filhos para Usar o Template Base

Agora, vamos modificar **`home.html`** e **`listar_produtos.html`** para "herdar" de **`base.html`**  e preencher seus respectivos blocos.

#### Arquivo **`home.html`**

```html

{% extends 'site_loja/base.html' %}

{% block title %}Página Inicial - Minha Loja{% endblock %}

{% block content %}

    {% include 'site_loja/partials/_header.html' %}

    <p>Explore nossos produtos incríveis.</p>
    
{% endblock %}

```

  * **`{% extends 'site_loja/base.html' %}`**: 
    - Esta tag é crucial\! Ela diz ao Django que este template (`home.html`) está herdando de `base.html`. Deve ser a **primeira tag de template** no arquivo.
    
  * Os blocos **`title`** e **`content`** estão sendo **sobrescritos**. 
    - O conteúdo que você colocar dentro desses blocos no `home.html` substituirá o conteúdo padrão (ou vazio) definido no `base.html`.

#### Arquivo **`produtos_listar.html`**

```html
{% extends 'site_loja/base.html' %}

{% block title %}Nossos Produtos - Minha Loja{% endblock %}

{% block content %}

    {% include 'site_loja/partials/_header.html' %}

    <h1>Nossos Produtos</h1>
    <div class="row">
        {% for produto in produtos %}
            <div class="col-md-4 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">{{ produto.nome }}</h5>
                        <p class="card-text">R$ {{ produto.preco|floatformat:2 }}</p>
                        <a href="#" class="btn btn-primary">Ver Detalhes</a>
                    </div>
                </div>
            </div>
        {% empty %}
            <p>Nenhum produto encontrado.</p>
        {% endfor %}
    </div>
{% endblock %}
```

Para este exemplo de `produtos_listar.html`, assumimos que você está passando uma lista de `produtos` do seu `views.py`.

### Exemplo de uso de **`super`**

Às vezes, você pode querer adicionar conteúdo a um bloco existente no template pai, em vez de substituí-lo completamente. Para isso, use a tag **`{{ block.super }}`** dentro do bloco no template filho.

Por exemplo, se você quisesse adicionar um CSS específico para a página de produtos, mantendo o Bootstrap global:

```html
{% extends 'site_loja/base.html' %}

{% block title %}Produtos - Minha Loja{% endblock %}

{% block extra_css %}
    {{ block.super }} 
    <style>
        .card {
            border: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0,0,0,.1);
        }
    </style>
{% endblock %}

{% block content %}
{% endblock %}
```

Neste caso, **`{{ block.super }}`** garante que o link do Bootstrap (definido no `base.html`) ainda seja incluído, e então seu CSS personalizado é adicionado abaixo.

## 🚨 Situação de Aprendizagem e Melhoria Contínua

Com a implementação de **`base.html`** e o uso de blocos, a manutenção do seu projeto **`site_loja`** se torna drasticamente mais fácil.

**Cenário:** A diretoria da loja decidiu que todas as páginas devem ter uma barra de navegação no topo, abaixo do `header`, com `links` para Home, Produtos e Contato.

**Antes (sem herança/blocos):** Você teria que abrir `home.html`, `listar_produtos.html` e qualquer outra página, e colar o código da navbar em cada um. Se mudassem um link, teria que fazer de novo em todas.

**Agora (com herança/blocos):**

:one:  **Crie o Partial da Navbar:**
    Crie um arquivo `_navbar.html` em `site_loja/templates/site_loja/partials/`:

    ```html
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'site_loja:home' %}">Loja</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="{% url 'site_loja:home' %}">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'site_loja:listar_produtos' %}">Produtos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Contato</a> </li>
                </ul>
            </div>
        </div>
    </nav>
    ```

    **Importante:** Você precisará definir a URL `site_loja:home` e `site_loja:listar_produtos` no seu arquivo `site_loja/urls.py`.

:two:  **Inclua a Navbar no `base.html`:**
    Abra seu `site_loja/templates/site_loja/base.html` e adicione o include da navbar abaixo do header:

    ```html
    ...
    <body>
        {% include 'site_loja/partials/_header.html' %}
        {% include 'site_loja/partials/_navbar.html' %} 
        <main class="container my-4">
            {% block content %}
            {% endblock %}
        </main>
    ...
    ```

**Resultado:** Instantaneamente, tanto a página `home` quanto a página de `listar_produtos` (e qualquer outra que herdar de `base.html`) terão a nova barra de navegação\! Se você precisar alterar um item do menu, faz isso apenas em `_navbar.html`. Isso é a **manutenibilidade** em ação.

## 🚀 Boas Práticas

  * **Padrão de Nomes:** 
    - Mantenha um padrão consistente para seus arquivos de partials (ex: sempre começando com **`_`**).
    
  * **Não Abusar:** 
    - vite criar partials para cada pequeno pedaço de HTML. 
    - Use-os para componentes lógicos e reutilizáveis.
    
  * **Complexidade:** 
    - Se um partial ou bloco estiver ficando muito complexo, considere se ele pode ser dividido em partials menores ou se talvez um **Custom Template Tag** ou Filter do Django seria mais apropriado.
    
  * **Variáveis em Includes:** 
    - Você pode passar variáveis para partials usando a cláusula **`with`**:
        - **`{% include 'site_loja/partials/_card_produto.html' with produto=p %}`**
        - Isso é útil para partials que representam componentes de uma lista, por exemplo.

Com o uso de **partials** e blocos, seu código se tornará mais limpo, mais fácil de entender e de manter. 