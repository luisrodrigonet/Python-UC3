## 10.01.01 : ğŸ§  Otimizando suas PÃ¡ginas Django com Partials e Blocos

No desenvolvimento web, especialmente com `Django`, Ã© muito comum termos elementos que se repetem em vÃ¡rias pÃ¡ginas, como o cabeÃ§alho (`header`), o rodapÃ© (`footer`) ou atÃ© mesmo barras de navegaÃ§Ã£o. Sem uma estratÃ©gia, vocÃª acabaria copiando e colando esse cÃ³digo em cada arquivo HTML, o que Ã© um pesadelo para a manutenÃ§Ã£o. Se precisar mudar uma coisinha no `header`, teria que alterar em todos os arquivos\!

Ã‰ aÃ­ que entram os **partials** (tambÃ©m chamados de includes ou pedaÃ§os de `template`) e os **blocos**. Eles sÃ£o ferramentas poderosas que o `Django` nos oferece para organizar o cÃ³digo HTML, evitar repetiÃ§Ã£o e, consequentemente, aumentar a **manutenibilidade** do seu projeto.

### ğŸ¯ Por que usar Partials e Blocos?

  * **ReutilizaÃ§Ã£o de CÃ³digo:** 
    - Evite copiar e colar. Escreva o cÃ³digo uma vez e reutilize-o em diversas pÃ¡ginas.
    
  * **Manutenibilidade:** 
    - FaÃ§a alteraÃ§Ãµes em um Ãºnico lugar e elas se refletirÃ£o em todas as pÃ¡ginas que utilizam aquele partial ou bloco.
    
  * **OrganizaÃ§Ã£o:** 
    - Divida seus templates em arquivos menores e mais especÃ­ficos, tornando o cÃ³digo mais legÃ­vel e fÃ¡cil de navegar.
    
  * **ColaboraÃ§Ã£o:** 
    - Facilita o trabalho em equipe, jÃ¡ que diferentes desenvolvedores podem trabalhar em partes diferentes do template sem conflitos.

### ğŸ¯ Entendendo o Projeto `core`

Usaremos como base o  projeto `core`, que jÃ¡ possui as aplicaÃ§Ãµes `produtos` e `site_loja`. Focaremos na aplicaÃ§Ã£o `site_loja`, que jÃ¡ tem uma pÃ¡gina `home` e uma pÃ¡gina para listar `produtos`.

Atualmente, sua aplicaÃ§Ã£o `site_loja` jÃ¡ usa `templates` e `partials`, mas nÃ£o o conceito de blocos. 

## :one: Melhorando o Uso de Partials

Os Partials sÃ£o arquivos de `template` menores que contÃªm pedaÃ§os de cÃ³digo HTML que podem ser incluÃ­dos em outros `templates`. Pense neles como "componentes" reutilizÃ¡veis.

### ğŸ§¾ Armazenando os partials

Ã‰ uma boa prÃ¡tica criar uma pasta dedicada para seus partials. Dentro da sua aplicaÃ§Ã£o **`site_loja`**, vocÃª pode criar uma pasta **`templates/site_loja/partials`**.

Por exemplo, a estrutura ficaria assim:

```
core/
â”œâ”€â”€ site_loja/
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”œâ”€â”€ site_loja/
â”‚   â”‚   â”‚   â”œâ”€â”€ partials/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ _header.html
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ _footer.html
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ _navbar.html
â”‚   â”‚   â”‚   â”œâ”€â”€ home.html
â”‚   â”‚   â”‚   â”œâ”€â”€ listar_produtos.html
â”‚   â”‚   â”‚   â””â”€â”€ base.html  <-- Vamos criar este em breve!
â”‚   â”œâ”€â”€ views.py
â”‚   â””â”€â”€ urls.py
â””â”€â”€ produtos/
    â””â”€â”€ ...
```

**Dica:** Ã‰ comum prefixar os nomes dos arquivos de partials com um underscore (**`_`**) (ex: **`_header.html`**) para indicar que eles sÃ£o arquivos "parciais" e nÃ£o templates de pÃ¡gina completos que serÃ£o renderizados diretamente.

### ğŸ§¾ Declarando e Usando um Partial

Para incluir um partial em seu template principal, vocÃª usa a **`tag`** de template **`{% include %}`** do Django.

Vamos imaginar que vocÃª tem um arquivo **`_header.html`** dentro de **`site_loja/templates/site_loja/partials/`** com o seguinte conteÃºdo:

```html
<header class="bg-dark text-white text-center py-3">
    <h1>Papagaio's - Loja Online</h1>
</header>
```

Agora, para usar este partial em seu `home.html`, vocÃª faria o seguinte:

```python
{% extends 'site_loja/base.html' %}

{% block title %}PÃ¡gina Inicial - Minha Loja{% endblock %}

{% block content %}

    {% include 'site_loja/partials/_header.html' %}

    <p>Explore nossos produtos incrÃ­veis.</p>
    
{% endblock %}
```

E o mesmo para **`produtos_lista.html`**:

```html
{% extends 'site_loja/base.html' %}

{% block title %}Nossos Produtos - Minha Loja{% endblock %}

{% block content %}

    {% include 'site_loja/partials/_header.html' %}

    <h1>Nossos Produtos</h1>
    <div class="row">
        {% for produto in produtos %}
            <div class="col-md-4 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">{{ produto.nome }}</h5>
                        <p class="card-text">R$ {{ produto.preco|floatformat:2 }}</p>
                        <a href="#" class="btn btn-primary">Ver Detalhes</a>
                    </div>
                </div>
            </div>
        {% empty %}
            <p>Nenhum produto encontrado.</p>
        {% endfor %}
    </div>
{% endblock %}
```

ğŸ’¡ **ObservaÃ§Ã£o:** A string **`'site_loja/partials/_header.html'`** Ã© o **caminho relativo** do template, comeÃ§ando da pasta `templates` que o Django procura.

Com isso, se vocÃª precisar mudar o tÃ­tulo do seu `header` ou adicionar um logo, farÃ¡ a alteraÃ§Ã£o apenas em `_header.html`, e todas as pÃ¡ginas que o incluem serÃ£o automaticamente atualizadas. JÃ¡ Ã© uma grande melhoria\!

## :two: Dominando os Blocos com HeranÃ§a de Templates

Enquanto partials sÃ£o Ã³timos para incluir pedaÃ§os de HTML, os **blocos** elevam a organizaÃ§Ã£o a um novo nÃ­vel, introduzindo o conceito de **heranÃ§a de templates**. Com heranÃ§a, vocÃª define um template "pai" (ou base) que contÃ©m a estrutura geral da sua pÃ¡gina e Ã¡reas "blocos" que podem ser preenchidas ou sobrescritas por templates "filhos".

Pense na heranÃ§a como um formulÃ¡rio prÃ©-preenchido. O formulÃ¡rio base (template pai) jÃ¡ tem campos padrÃ£o, mas vocÃª pode preencher campos especÃ­ficos (blocos) em cada cÃ³pia do formulÃ¡rio (template filho).

### ğŸ“Œ Revisando o Template Base (`base.html`)

Vamos ajustar o template base que conterÃ¡ toda a estrutura comum das suas pÃ¡ginas, incluindo os **partials** que jÃ¡ definimos.

Crie um arquivo **`base.html`** dentro de **`site_loja/templates/site_loja/`**.

```html
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <!-- Block title -->
    <title>{% block title %}Papagaio's -  Loja Online{% endblock %}</title>

    <!-- Bloco extra_css -->
    {% block extra_css %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
        rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
        crossorigin="anonymous">
    {% endblock %}
    <!-- Bloco extra_css -->


</head>

<body>

    <!-- Partial - _navbar.html -->
    {% include 'site_loja/partials/_navbar.html' %}


    <main class="container mt-4">

        <!-- Bloco - content -->
        {% block content %}
        {% endblock %}
        <!-- Bloco - content -->

    </main>

    <!-- Partial - _footer.html -->
    {% include 'site_loja/partials/_footer.html' %}
    

    <!-- Bloco - extra_js -->
    {% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIh7/8yUq2p3I4k64bB" 
        crossorigin="anonymous">
    </script>
    {% endblock %}
    <!-- Bloco - extra_js -->

</body>
</html>
```

### ğŸ“Œ Entendendo as Tags de Bloco

  * **`{% block nome_do_bloco %}`**: 
    - Inicia a definiÃ§Ã£o de um bloco. 
    - O `nome_do_bloco` deve ser Ãºnico dentro do template pai.
    
  * **`{% endblock %}`**: Fecha o bloco.

No **`base.html`**, definimos os blocos principais:

1.  **`title`**: 
    - Para o tÃ­tulo da pÃ¡gina na aba do navegador. 
    - Tem um valor padrÃ£o "Minha Loja Online".
    
2.  **`extra_css`**: 
    - Para incluir links CSS especÃ­ficos que uma pÃ¡gina filha possa precisar (alÃ©m do Bootstrap global).
    
3.  **`content`**: 
    - Este Ã© o bloco mais importante, onde o conteÃºdo exclusivo de cada pÃ¡gina serÃ¡ inserido.
    
4.  **`extra_js`**: 
    - Para incluir scripts JavaScript especÃ­ficos.

### ğŸ“Œ Modificando Templates Filhos para Usar o Template Base

Agora, vamos modificar **`home.html`** e **`listar_produtos.html`** para "herdar" de **`base.html`**  e preencher seus respectivos blocos.

#### Arquivo **`home.html`**

```html

{% extends 'site_loja/base.html' %}

{% block title %}PÃ¡gina Inicial - Minha Loja{% endblock %}

{% block content %}

    {% include 'site_loja/partials/_header.html' %}

    <p>Explore nossos produtos incrÃ­veis.</p>
    
{% endblock %}

```

  * **`{% extends 'site_loja/base.html' %}`**: 
    - Esta tag Ã© crucial\! Ela diz ao Django que este template (`home.html`) estÃ¡ herdando de `base.html`. Deve ser a **primeira tag de template** no arquivo.
    
  * Os blocos **`title`** e **`content`** estÃ£o sendo **sobrescritos**. 
    - O conteÃºdo que vocÃª colocar dentro desses blocos no `home.html` substituirÃ¡ o conteÃºdo padrÃ£o (ou vazio) definido no `base.html`.

#### Arquivo **`produtos_listar.html`**

```html
{% extends 'site_loja/base.html' %}

{% block title %}Nossos Produtos - Minha Loja{% endblock %}

{% block content %}

    {% include 'site_loja/partials/_header.html' %}

    <h1>Nossos Produtos</h1>
    <div class="row">
        {% for produto in produtos %}
            <div class="col-md-4 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">{{ produto.nome }}</h5>
                        <p class="card-text">R$ {{ produto.preco|floatformat:2 }}</p>
                        <a href="#" class="btn btn-primary">Ver Detalhes</a>
                    </div>
                </div>
            </div>
        {% empty %}
            <p>Nenhum produto encontrado.</p>
        {% endfor %}
    </div>
{% endblock %}
```

Para este exemplo de `produtos_listar.html`, assumimos que vocÃª estÃ¡ passando uma lista de `produtos` do seu `views.py`.

### Exemplo de uso de **`super`**

Ã€s vezes, vocÃª pode querer adicionar conteÃºdo a um bloco existente no template pai, em vez de substituÃ­-lo completamente. Para isso, use a tag **`{{ block.super }}`** dentro do bloco no template filho.

Por exemplo, se vocÃª quisesse adicionar um CSS especÃ­fico para a pÃ¡gina de produtos, mantendo o Bootstrap global:

```html
{% extends 'site_loja/base.html' %}

{% block title %}Produtos - Minha Loja{% endblock %}

{% block extra_css %}
    {{ block.super }} 
    <style>
        .card {
            border: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0,0,0,.1);
        }
    </style>
{% endblock %}

{% block content %}
{% endblock %}
```

Neste caso, **`{{ block.super }}`** garante que o link do Bootstrap (definido no `base.html`) ainda seja incluÃ­do, e entÃ£o seu CSS personalizado Ã© adicionado abaixo.

## ğŸš¨ SituaÃ§Ã£o de Aprendizagem e Melhoria ContÃ­nua

Com a implementaÃ§Ã£o de **`base.html`** e o uso de blocos, a manutenÃ§Ã£o do seu projeto **`site_loja`** se torna drasticamente mais fÃ¡cil.

**CenÃ¡rio:** A diretoria da loja decidiu que todas as pÃ¡ginas devem ter uma barra de navegaÃ§Ã£o no topo, abaixo do `header`, com `links` para Home, Produtos e Contato.

**Antes (sem heranÃ§a/blocos):** VocÃª teria que abrir `home.html`, `listar_produtos.html` e qualquer outra pÃ¡gina, e colar o cÃ³digo da navbar em cada um. Se mudassem um link, teria que fazer de novo em todas.

**Agora (com heranÃ§a/blocos):**

:one:  **Crie o Partial da Navbar:**
    Crie um arquivo `_navbar.html` em `site_loja/templates/site_loja/partials/`:

    ```html
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'site_loja:home' %}">Loja</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="{% url 'site_loja:home' %}">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'site_loja:listar_produtos' %}">Produtos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Contato</a> </li>
                </ul>
            </div>
        </div>
    </nav>
    ```

    **Importante:** VocÃª precisarÃ¡ definir a URL `site_loja:home` e `site_loja:listar_produtos` no seu arquivo `site_loja/urls.py`.

:two:  **Inclua a Navbar no `base.html`:**
    Abra seu `site_loja/templates/site_loja/base.html` e adicione o include da navbar abaixo do header:

    ```html
    ...
    <body>
        {% include 'site_loja/partials/_header.html' %}
        {% include 'site_loja/partials/_navbar.html' %} 
        <main class="container my-4">
            {% block content %}
            {% endblock %}
        </main>
    ...
    ```

**Resultado:** Instantaneamente, tanto a pÃ¡gina `home` quanto a pÃ¡gina de `listar_produtos` (e qualquer outra que herdar de `base.html`) terÃ£o a nova barra de navegaÃ§Ã£o\! Se vocÃª precisar alterar um item do menu, faz isso apenas em `_navbar.html`. Isso Ã© a **manutenibilidade** em aÃ§Ã£o.

## ğŸš€ Boas PrÃ¡ticas

  * **PadrÃ£o de Nomes:** 
    - Mantenha um padrÃ£o consistente para seus arquivos de partials (ex: sempre comeÃ§ando com **`_`**).
    
  * **NÃ£o Abusar:** 
    - vite criar partials para cada pequeno pedaÃ§o de HTML. 
    - Use-os para componentes lÃ³gicos e reutilizÃ¡veis.
    
  * **Complexidade:** 
    - Se um partial ou bloco estiver ficando muito complexo, considere se ele pode ser dividido em partials menores ou se talvez um **Custom Template Tag** ou Filter do Django seria mais apropriado.
    
  * **VariÃ¡veis em Includes:** 
    - VocÃª pode passar variÃ¡veis para partials usando a clÃ¡usula **`with`**:
        - **`{% include 'site_loja/partials/_card_produto.html' with produto=p %}`**
        - Isso Ã© Ãºtil para partials que representam componentes de uma lista, por exemplo.

Com o uso de **partials** e blocos, seu cÃ³digo se tornarÃ¡ mais limpo, mais fÃ¡cil de entender e de manter. 