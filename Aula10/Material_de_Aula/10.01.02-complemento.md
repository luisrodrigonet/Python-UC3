## 10.01.02 (Complemento) : Tipos de Tags e Vari√°veis do Django

O Django possui uma s√©rie de **tags** e **filtros** para tornar seus **templates** din√¢micos. Vamos explorar os mais comuns:

### :one: Vari√°veis: `{{ var_name }}`

As **vari√°veis** s√£o usadas para exibir dados que voc√™ passa do seu arquivo **`views.py`** para o **template**.

**Exemplo no `listar_produtos.html`:**

```html
<h5 class="card-title">{{ produto.nome }}</h5>
<p class="card-text">{{ produto.descricao }}</p>
<p class="card-text"><strong>R$ {{ produto.preco|floatformat:2 }}</strong></p>
```

Aqui, **`produto.nome`**, **`produto.descricao`**, e **`produto.preco`** s√£o vari√°veis que cont√™m informa√ß√µes sobre cada produto.

**Como as vari√°veis chegam ao template (no `views.py` da aplica√ß√£o `site_loja`):**

```python
# site_loja/views.py
from django.shortcuts import render
from produtos.models import Produto # Importe o modelo Produto da sua app 'produtos'

def home(request):
    return render(request, 'site_loja/home.html')

def listar_produtos(request):
    produtos = Produto.objects.all() # Busca todos os produtos do banco de dados
    context = {
        'produtos': produtos # Passa a lista de produtos para o template
    }
    return render(request, 'site_loja/listar_produtos.html', context)
```

Na view  **`produtos_listar`**, **`context`** √© um dicion√°rio onde as chaves (**`'produtos'`**) se tornam os nomes das vari√°veis que voc√™ pode usar no seu **template**, e os valores (**`produtos`**) s√£o os dados que essas vari√°veis ir√£o exibir.

### :two: Tags de Bloco: `{% tag %}`

Essas tags controlam a **l√≥gica do template**.

#### üì¶ `{% for %}` e `{% endfor %}`: Loops

Usadas para iterar sobre listas (como sua lista de produtos).

**Exemplo no `listar_produtos.html`:**

```html
{% for produto in produtos %}
    <div class="col-md-4 mb-4">
    </div>
{% endfor %}
```

Para cada `produto` na lista `produtos`, o c√≥digo dentro do bloco `{% for %}` ser√° repetido.

#### üì¶ `{% if %}`, `{% elif %}`, `{% else %}` e `{% endif %}`: Condicionais

Usadas para exibir conte√∫do com base em uma condi√ß√£o.

**Exemplo no `listar_produtos.html` (com `{% empty %}`):**

```html
{% for produto in produtos %}
    {% empty %}
    <div class="col-12">
        <p class="alert alert-info">Nenhum produto cadastrado no momento.</p>
    </div>
{% endfor %}
```

A tag **`{% empty %}`** dentro de um **`{% for %}`** √© um atalho √∫til. Se a lista sobre a qual voc√™ est√° iterando estiver vazia, o conte√∫do dentro de **`{% empty %}`** ser√° exibido. Caso contr√°rio, o loop **`{% for %}`** ser√° executado normalmente.

Voc√™ tamb√©m pode usar **`if`** para outras condi√ß√µes, como visto no **`_navbar.html`** para verificar se o usu√°rio est√° autenticado:

```html
{% if request.user.is_authenticated %}
    <span class="navbar-text">
        Ol√°, {{ request.user.username }}!
    </span>
{% else %}
    <a class="btn btn-outline-success" href="#">Login</a>
{% endif %}
```

Essa tag **`request.user`** √© uma **vari√°vel de contexto** que o Django disponibiliza automaticamente em todos os templates se voc√™ tiver as configura√ß√µes padr√£o de autentica√ß√£o.

#### üì¶ `{% url %}`: Gerando URLs

Essencial para criar links din√¢micos no seu projeto. Em vez de realiza o "hardcoding" das URLs, voc√™ usa o nome da URL que voc√™ definiu no seu **`urls.py`**.

**Exemplo no `_navbar.html` e `home.html`:**

```html
<a class="navbar-brand" href="{% url 'home' %}">Minha Loja</a>
<a class="nav-link" href="{% url 'listar_produtos' %}">Produtos</a>
```

Isso √© muito mais robusto. Se voc√™ mudar a URL de **`home`** ou **`listar_produtos`** no **`urls.py`**, seus links no template ser√£o atualizados automaticamente, sem precisar modificar os templates.

**Configura√ß√£o no `urls.py` (do projeto `core` e da aplica√ß√£o `site_loja`):**

```python
# core/urls.py
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('site_loja.urls')), # Inclui as URLs da sua app site_loja
    path('produtos/', include('produtos.urls')), # Inclui as URLs da sua app produtos (se existirem)
]
```

```python
# site_loja/urls.py
from django.urls import path
from . import views

urlpatterns = [
    path('', views.home, name='home'), # name='home' √© o nome que voc√™ usa na tag {% url %}
    path('produtos/', views.listar_produtos, name='listar_produtos'), # name='listar_produtos'
]
```

#### üì¶ `{% csrf_token %}`: Prote√ß√£o contra ataques CSRF

Esta √© uma **tag de seguran√ßa crucial** para qualquer formul√°rio que fa√ßa altera√ß√µes no seu banco de dados (**POST, PUT, DELETE**). Ela gera um token secreto que o Django verifica para garantir que a requisi√ß√£o est√° vindo de uma fonte leg√≠tima, protegendo seu site contra ataques de **Cross-Site Request Forgery**.

Voc√™ deve sempre inclu√≠-la dentro dos seus formul√°rios:

```html
<form method="post">
    {% csrf_token %}
    <input type="text" name="nome_do_campo">
    <button type="submit">Enviar</button>
</form>
```

#### üì¶ `{% comment %}` e `{% endcomment %}`: Coment√°rios

Para adicionar coment√°rios no seu template que n√£o ser√£o renderizados no HTML final.

```html
{% comment %}
    Este √© um coment√°rio no template.
    Ele n√£o aparecer√° no c√≥digo-fonte da p√°gina.
{% endcomment %}

<p>Este texto ser√° vis√≠vel.</p>
```

#### üì¶ `{% debug %}`: Informa√ß√µes de Depura√ß√£o

Muito √∫til durante o desenvolvimento para inspecionar vari√°veis e o contexto do template. **Nunca use em produ√ß√£o\!**

```html
{# No seu template #}
{% debug %}
```

Isso imprimir√° um relat√≥rio detalhado de todas as vari√°veis dispon√≠veis no contexto atual do template.

### :three: Filtros: `{{ var|filter }}`

Os **Filtros** s√£o usados para transformar a exibi√ß√£o das vari√°veis. Eles s√£o aplicados usando o caractere **`|`** (pipe).

**Exemplo no `listar_produtos.html`:**

```html
<p class="card-text"><strong>R$ {{ produto.preco|floatformat:2 }}</strong></p>
```

O filtro `floatformat:2` garante que o pre√ßo do produto ser√° exibido com duas casas decimais, o que √© ideal para valores monet√°rios.

Vamos adicionar mais alguns filtros importantes:

####  ‚ÑπÔ∏è **`|date:"F j, Y"`:** 

**Formata uma data.**

- Ex: `{{ post.pub_date|date:"F j, Y" }}` pode exibir "July 18, 2025".

- No seu `_footer.html`, j√° usamos `{% now "Y" %}` para pegar o ano atual. 

- Podemos usar `{% now "d/m/Y H:i" %}` para data e hora completas.

####  ‚ÑπÔ∏è  **`|length`:** 

**Retorna o n√∫mero de itens** em uma lista ou o comprimento de uma string.

- Ex: `{{ lista_de_itens|length }}` (se `lista_de_itens` tiver 3 itens, o resultado ser√° `3`).

####  ‚ÑπÔ∏è   **`|upper`:** 

Converte uma string para **mai√∫sculas**.

- Ex: `{{ nome|upper }}` (`"jo√£o"` vira `"JO√ÉO"`).

####  ‚ÑπÔ∏è   **`|lower`:** 

Converte uma string para **min√∫sculas**.

- Ex: `{{ nome|lower }}` (`"MARIA"` vira `"maria"`).

####  ‚ÑπÔ∏è   **`|capfirst`:** 

Converte a **primeira letra** da string para mai√∫scula.

- Ex: `{{ nome|capfirst }}` (`"jo√£o"` vira `"Jo√£o"`).

####  ‚ÑπÔ∏è   **`|default:"N/A"`:** D

efine um valor padr√£o se a vari√°vel estiver vazia ou n√£o existir.

- Ex: `{{ descricao|default:"Sem descri√ß√£o dispon√≠vel" }}`. 

- Se `descricao` for vazia, mostra "Sem descri√ß√£o dispon√≠vel".

####  ‚ÑπÔ∏è   **`|truncatechars:num`:** 

Trunca (corta) uma string ap√≥s um determinado n√∫mero de caracteres. Adiciona "..." ao final, se cortado.

- Ex: `{{ produto.descricao|truncatechars:100 }}` (corta a descri√ß√£o se tiver mais de 100 caracteres). 

Voc√™ pode ver um exemplo disso no `listar_produtos.html` atualizado.

####  ‚ÑπÔ∏è   **`|safe`:** 

Marca uma string como "segura" para ser renderizada como HTML. 

Por padr√£o, o Django escapa caracteres HTML para evitar ataques de XSS (Cross-Site Scripting). 

Use `|safe` APENAS se tiver certeza de que o conte√∫do da vari√°vel √© confi√°vel.

- Ex: Se `minha_html = "<strong>Texto em negrito</strong>"`, ent√£o `{{ minha_html }}` renderizaria `&lt;strong&gt;Texto em negrito&lt;/strong&gt;`. 

Mas `{{ minha_html|safe }}` renderizaria **Texto em negrito**.

####  ‚ÑπÔ∏è   **`|add:"valor"`:** 

Adiciona um valor a um n√∫mero.

- Ex: `{{ numero|add:"10" }}` (se `numero` for 5, o resultado ser√° 15).

####  ‚ÑπÔ∏è   **`|slugify`:** 

Converte uma string para um "slug" (formato amig√°vel para URLs).

- Ex: `{{ titulo|slugify }}` (`"Meu T√≠tulo Legal"` vira `"meu-titulo-legal"`).


## üìÅ Conectando o Front-end (HTML/CSS/JS) com o Backend (Django)

### ‚ö†Ô∏è Bootstrap 5.3

Voc√™ j√° est√° incluindo o Bootstrap via CDN em seu `base.html`, o que √© uma excelente forma de come√ßar. O Bootstrap cuidar√° da maior parte do design responsivo e dos componentes da interface do usu√°rio, tornando suas p√°ginas bonitas e funcionais em diferentes dispositivos.

### ‚ö†Ô∏è Arquivos Est√°ticos (CSS, JavaScript, Imagens)

Para seus pr√≥prios arquivos C**SS, JavaScript ou imagens**, o Django tem um sistema para gerenci√°-los, conhecido como **arquivos est√°ticos**.

:one:  **Configura√ß√£o em `settings.py`:**

Certifique-se de que as seguintes configura√ß√µes est√£o presentes no seu `core/settings.py`:

```python
# core/settings.py
import os

# ... outras configura√ß√µes ...

STATIC_URL = '/static/'

# Onde o Django vai procurar por arquivos est√°ticos nas suas apps
STATICFILES_DIRS = [
    os.path.join(BASE_DIR, 'static'),
]

# Onde o Django vai coletar todos os arquivos est√°ticos para deploy
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')
```

:two: **Crie uma pasta `static` na raiz do seu projeto `core`:**

```
core/
‚îú‚îÄ‚îÄ core/
‚îú‚îÄ‚îÄ produtos/
‚îú‚îÄ‚îÄ site_loja/
‚îú‚îÄ‚îÄ static/  <-- Crie esta pasta
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ style.css
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ script.js
‚îÇ   ‚îî‚îÄ‚îÄ img/
‚îÇ       ‚îî‚îÄ‚îÄ logo.png
‚îú‚îÄ‚îÄ manage.py
‚îî‚îÄ‚îÄ db.sqlite3
```

:three:  **Use a tag `{% static %}` nos seus templates:**

Para usar arquivos est√°ticos nos seus templates, voc√™ precisa carregar a tag **`static`** no in√≠cio do seu arquivo HTML e usar **`{% static 'path/to/your/file.css' %}`**.

```html
{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Minha Loja Online{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <script src="{% static 'js/script.js' %}"></script>
</body>
</html>
```

Isso garante que o Django encontre e sirva corretamente seus arquivos est√°ticos.


## Recapitulando os Pontos Chave

  * **Templates:** Arquivos HTML que definem a estrutura da p√°gina.
  
  * **Tags:** L√≥gica e controles dentro dos templates (ex: `{% for %}`, `{% if %}`, `{% url %}`, `{% include %}`, `{% extends %}`, `{% block %}`, `{% csrf_token %}`, `{% comment %}`, `{% debug %}`).
  
  * **Vari√°veis:** Exibem dados din√¢micos passados das suas views (ex: `{{ produto.nome }}`, `{{ request.user.username }}`).
  
  * **Filtros:** Modificam a exibi√ß√£o das vari√°veis (ex: `{{ produto.preco|floatformat:2 }}`, `{{ descricao|truncatechars:100 }}`, `{{ nome|upper }}`, `{{ data|date:"d/m/Y" }}`, `{{ html_seguro|safe }}`).
  
  * **Partials (`_partials`):** Pequenos peda√ßos de template reutiliz√°veis, inclu√≠dos com `{% include %}`.
  
  * **Blocos (`{% block %}` e `{% extends %}`):** A forma mais poderosa de reutilizar templates, permitindo que templates filhos preencham ou sobrescrevam se√ß√µes de um template pai.

