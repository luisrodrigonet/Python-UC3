## 10.01.03 : Gerenciando Arquivos Est√°ticos e de M√≠dia no Django

Aprenderemos como gerenciar **arquivos est√°ticos** e **arquivos de m√≠dia** em projetos Django. 

### üèó Arquivos Est√°ticos e de M√≠dia?

Antes de mergulharmos na pr√°tica, √© importante entender a diferen√ßa entre eles:

  * **Arquivos Est√°ticos:** Pense neles como os "adere√ßos" do seu site ‚Äì coisas que n√£o mudam frequentemente e s√£o essenciais para a apresenta√ß√£o e interatividade. Isso inclui:

      * **`CSS (.css)`:** Define o estilo visual do seu site (cores, fontes, layouts).
      
      * **`JavaScript (.js)`:** Adiciona interatividade e dinamismo (anima√ß√µes, valida√ß√µes de formul√°rio).
      
      * **`Imagens (.png, .jpg, .svg)`:** Imagens do layout, √≠cones, logotipos.
      
      * **`Fontes (.woff, .ttf)`:** Fontes personalizadas usadas no design.

    No projeto, o CSS e o JavaScript do Bootstrap 5.3 se encaixam perfeitamente aqui.

  * **Arquivos de M√≠dia:** S√£o arquivos carregados pelos usu√°rios ou pelo pr√≥prio sistema, e que podem mudar com frequ√™ncia. Exemplos comuns s√£o:

      * **`Imagens de produtos`:** Fotos que voc√™ ou seus clientes far√£o upload para a loja.
      
      * **`V√≠deos`:** V√≠deos de demonstra√ß√£o.
      
      * **`Documentos`:** PDFs, arquivos DOCX.

    No seu caso, as imagens dos produtos da aplica√ß√£o `produtos` seriam arquivos de m√≠dia.

Separar e configurar esses arquivos √© crucial por v√°rias raz√µes:

1. **Organiza√ß√£o:** Mant√©m seu projeto limpo e f√°cil de gerenciar.
2. **Desempenho:** O Django serve arquivos est√°ticos de forma otimizada para produ√ß√£o.
3. **Seguran√ßa:** Evita que arquivos confidenciais sejam expostos.
4. **Escalabilidade:** Facilita a implanta√ß√£o em servidores de produ√ß√£o.

### üèó Configurando Arquivos Est√°ticos (Static Files)

Centralizaremos os arquivos est√°ticos na pasta principal do seu projeto `core`, em vez de t√™-los dentro de cada aplica√ß√£o. Essa √© uma abordagem comum e pode simplificar o gerenciamento de arquivos que s√£o globais ao seu projeto.

Vamos ajustar as configura√ß√µes no seu arquivo `core/settings.py` e a estrutura de pastas para refletir essa mudan√ßa.

#### :one: Estrutura de Pastas

Dentro da pasta principal do projeto, crie uma pasta chamada **`static`**. Dentro dela, crie subpastas para organizar seus arquivos est√°ticos, como **`css`**, **`js`** e **`img`**.

Sua estrutura deve ficar assim:

```
core/
‚îú‚îÄ‚îÄ static/           <-- Pasta de arquivos est√°ticos
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ style.css
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ script.js
‚îÇ   ‚îî‚îÄ‚îÄ img/
‚îÇ       ‚îî‚îÄ‚îÄ logo.png
‚îú‚îÄ‚îÄ produtos/
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ site_loja/
‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ site_loja/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ home.html
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ listar_produtos.html
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ partials/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ _header.html
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ _footer.html
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ base.html
‚îÇ   ‚îú‚îÄ‚îÄ views.py
‚îÇ   ‚îî‚îÄ‚îÄ urls.py
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ settings.py
‚îÇ   ‚îú‚îÄ‚îÄ urls.py
‚îÇ   ‚îî‚îÄ‚îÄ wsgi.py
‚îú‚îÄ‚îÄ media/            <-- Pasta de m√≠dia permanece aqui
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ manage.py
```

#### :two: Configura√ß√µes no `settings.py`

Abra o arquivo **`core/settings.py`** e adicione as seguintes configura√ß√µes:

Agora, precisamos dizer ao Django onde encontrar esses arquivos est√°ticos. Abra o arquivo `core/settings.py` e ajuste as configura√ß√µes de `STATICFILES_DIRS`:

```python
# core/settings.py

# Importa√ß√£o da classe Path do m√≥dulo pathlib (aula 10)
from pathlib import Path

# ... outras configura√ß√µes ...

# Defini√ß√£o do diret√≥rio base do projeto usando pathlib (aula 10)
# BASE_DIR agora √© um objeto Path, o que √© mais conveniente!
BASE_DIR = Path(__file__).resolve().parent.parent

# Caminho onde o Django vai procurar por arquivos est√°ticos nas aplica√ß√µes (aula 10)
STATIC_URL = '/static/'

# Diret√≥rios adicionais onde o Django vai procurar por arquivos est√°ticos (aula 10)
# Apontamos diretamente para a pasta 'static' na raiz do projeto
STATICFILES_DIRS = [
    BASE_DIR / 'static', # Usando o operador de divis√£o (/) para unir caminhos
]

# O diret√≥rio onde os arquivos est√°ticos ser√£o coletados para produ√ß√£o (aula 10)
STATIC_ROOT = BASE_DIR / 'staticfiles' # Mais uma vez, usando o operador /

# ... continue com o restante das suas configura√ß√µes ...

# Configura√ß√µes de M√≠dia (tamb√©m ser√£o atualizadas para pathlib) (aula 10)
MEDIA_URL = '/media/'
MEDIA_ROOT = BASE_DIR / 'media'
```

**Explica√ß√£o:**

  * **`STATIC_URL = '/static/'`**: 
      * Define a URL base para servir arquivos est√°ticos. 
      * Ou seja, quando voc√™ se referir a um arquivo est√°tico no seu HTML, o Django vai procurar em **`/static/`**.
   
  
  * **`STATICFILES_DIRS = [...]`**: 
      * Uma lista de diret√≥rios onde o Django deve procurar por arquivos est√°ticos que n√£o est√£o dentro da pasta **`static`** de uma aplica√ß√£o. 
      * Aqui, estamos apontando para a pasta **`site_loja/static`** que acabamos de criar.
      
  * **`STATIC_ROOT`**: 
      * Este √© o diret√≥rio para onde o comando **`python manage.py collectstatic`** (usado em produ√ß√£o) vai copiar todos os seus arquivos est√°ticos. 
      * N√£o se preocupe com ele por enquanto.

#### :three: Carregando Arquivos Est√°ticos nos Templates

Agora √© hora de usar seus arquivos est√°ticos nos templates. Para isso, vamos utilizar o conceito de **blocos** no Django, que √© fundamental para um bom reuso de c√≥digo e organiza√ß√£o de templates.

##### üß© Atualizando o Template Base (`base.html`)

No Django, √© uma boa pr√°tica ter um template "pai" (**`base.html`**) que cont√©m a estrutura b√°sica do seu site (**cabe√ßalho, rodap√©, navega√ß√£o**) e de onde outros templates "filhos" (como `home.html` e `listar_produtos.html`) herdam essa estrutura. Isso elimina a duplica√ß√£o de c√≥digo.

Ajuste o arquivo **`base.html`** dentro da pasta **`site_loja/templates/site_loja/`**:

```html
{# ESSA LINHA √â CR√çTICA PARA USAR STATIC FILES #}
{# Aula 10.01.03 #}
{% load static %} 
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <!-- Block title -->
    <title>{% block title %}Papagaio's -  Loja Online{% endblock %}</title>

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
        rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
        crossorigin="anonymous">

    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    

    <!-- Bloco extra_css -->
    {% block extra_css %}
    
    {% endblock %}
    <!-- Bloco extra_css -->

</head>
<body>

    <!-- Partial - _navbar.html -->
    {% include 'site_loja/partials/_navbar.html' %}
    
    <main class="container mt-4">

        <!-- Bloco - content -->
        {% block content %}
        {% endblock %}
        <!-- Bloco - content -->

    </main>

    <!-- Partial - _footer.html -->
    {% include 'site_loja/partials/_footer.html' %}
    
    <!-- JS --> 
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIh7/8yUq2p3I4k64bB" 
        crossorigin="anonymous">
    </script>

    <script src="{% static 'js/script.js' %}"></script>

    <!-- Bloco - extra_js -->
    {% block extra_js %}
    
    {% endblock %}
    <!-- Bloco - extra_js -->

</body>
</html>
```

**Pontos importantes no `base.html`:**

  * **`{% load static %}`**:
      * **ESSENCIAL\!** Esta tag precisa estar no topo do template para que voc√™ possa usar a tag **`{% static %}`**.
      * 
  * **`{% static 'css/style.css' %}`**: 
      * √â assim que voc√™ referencia um arquivo est√°tico. 
      * O Django vai substituir isso pela URL correta (ex: **`/static/css/style.css`**).
      
  * **`{% block title %}`**: 
      * Um bloco que os templates filhos podem sobrescrever para definir o t√≠tulo da p√°gina.
      *
  * **`{% block extra_css %}` e `{% block extra_js %}`**: 
      * Blocos vazios que podem ser preenchidos por templates filhos se precisarem de CSS ou JS espec√≠ficos.
      
  * **`{% block content %}**`: 
      * O bloco principal onde o conte√∫do de cada p√°gina individual ser√° inserido.
      
  * **`{% include 'site_loja/partials/_header.html' %}`**: 
      * Continua usando seus partials existentes.


### Configurando Arquivos de M√≠dia (Media Files)

Arquivos de m√≠dia s√£o diferentes porque s√£o carregados *dinamicamente*. Por exemplo, as imagens dos seus produtos.

#### :one: Configura√ß√µes no `settings.py`

No seu **`core/settings.py`**, adicione as seguintes configura√ß√µes para arquivos de m√≠dia:

```python
# core/settings.py

# ... (logo abaixo das configura√ß√µes de STATIC) ...

# URL base para servir arquivos de m√≠dia
MEDIA_URL = '/media/'

# Diret√≥rio onde os arquivos de m√≠dia ser√£o armazenados no servidor
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')

# ... continue com o restante das suas configura√ß√µes ...
```

**Explica√ß√£o:**

  * `MEDIA_URL = '/media/'`: 
      * Define a URL base para servir arquivos de m√≠dia. 
      * Quando voc√™ referenciar uma imagem de produto, por exemplo, ela ser√° servida a partir de `/media/`.
      
  * `MEDIA_ROOT = os.path.join(BASE_DIR, 'media')`: 
      * Este √© o caminho absoluto no seu sistema de arquivos onde o Django armazenar√° os arquivos de m√≠dia carregados (imagens de produtos, por exemplo).

#### :two: Configurando o `urls.py` do Projeto

Durante o desenvolvimento, precisamos dizer ao Django para servir esses arquivos de m√≠dia. 

üåü **Importante:** Esta configura√ß√£o √© apenas para o ambiente de desenvolvimento. Em produ√ß√£o, um servidor web (como **Nginx** ou **Apache**) ser√° respons√°vel por servir esses arquivos.

Abra o arquivo **`core/urls.py`** (o arquivo URL principal do seu projeto) e adicione as configura√ß√µes de m√≠dia:

```python
# core/urls.py

from django.contrib import admin
from django.urls import path, include

# Adicione estas importa√ß√µes para servir arquivos de m√≠dia em desenvolvimento (Aula 10)
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('site_loja.urls')), # Inclui as URLs da sua app site_loja
    path('produtos/', include('produtos.urls')), # Inclui as URLs da sua app produtos
]

# Configura√ß√£o para servir arquivos de m√≠dia apenas em modo de desenvolvimento (Aula 10)
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

üëâ **Explica√ß√£o:**

  * **`if settings.DEBUG:`**: 
      * Essa condi√ß√£o garante que os arquivos de m√≠dia s√≥ sejam servidos pelo Django quando o `DEBUG` estiver como `True` (modo de desenvolvimento).
      *
  * **`urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)`**: 
      * Esta linha adiciona uma nova regra de URL que permite ao Django servir os arquivos localizados no `MEDIA_ROOT` sob a URL `MEDIA_URL`.

#### :three: Usando Arquivos de M√≠dia nos Templates

Para exibir imagens de produtos (que seriam arquivos de m√≠dia), voc√™ precisaria ter um modelo (`Model`) `Produto` com um campo `ImageField`.

**Exemplo de um Modelo `Produto` (na sua aplica√ß√£o `produtos`):**

```python
# produtos/models.py (aula 10)

from django.db import models

##
# Primeira vers√£o do model adicionado na aula 10
##
class Produto(models.Model):
    nome = models.CharField(max_length=100)
    descricao = models.TextField()
    preco = models.DecimalField(max_digits=10, decimal_places=2)
    imagem = models.ImageField(upload_to='produtos/', blank=True, null=True) # Campo para imagem

    def __str__(self):
        return self.nome
```

üö® **N√£o se esque√ßa de rodar as migra√ß√µes ap√≥s adicionar ou modificar modelos:**

```bash
python manage.py makemigrations produtos
```

```bash
Migrations for 'produtos':
  produtos\migrations\0001_initial.py
    + Create model Produto
```

```bash
python manage.py migrate
```

```bash
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, produtos, sessions
Running migrations:
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying admin.0002_logentry_remove_auto_add... OK
  Applying admin.0003_logentry_add_action_flag_choices... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying auth.0007_alter_validators_add_error_messages... OK
  Applying auth.0008_alter_user_username_max_length... OK
  Applying auth.0009_alter_user_last_name_max_length... OK
  Applying auth.0010_alter_group_name_max_length... OK
  Applying auth.0011_update_proxy_permissions... OK
  Applying auth.0012_alter_user_first_name_max_length... OK
  Applying produtos.0001_initial... OK
  Applying sessions.0001_initial... OK
```

üìé **Exemplo de como exibir a imagem de um produto no seu template `listar_produtos.html`:**

```html
{% extends 'site_loja/base.html' %}

{% block title %}Nossos Produtos - Minha Loja{% endblock %}

{% block content %}
    <h1>Confira Nossos Produtos</h1>
    <div class="row">
        {% for produto in produtos %}
            <div class="col-md-4 mb-4">
                <div class="card">
                    {% if produto.imagem %}
                        <img src="{{ produto.imagem.url }}" class="card-img-top" alt="{{ produto.nome }}">
                    {% else %}
                        <img src="{% static 'img/default_product.png' %}" class="card-img-top" alt="Imagem Padr√£o">
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">{{ produto.nome }}</h5>
                        <p class="card-text">{{ produto.descricao|truncatechars:100 }}</p>
                        <p class="card-text"><strong>R$ {{ produto.preco }}</strong></p>
                        <a href="#" class="btn btn-primary">Ver Detalhes</a>
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="col-12">
                <p>Nenhum produto cadastrado no momento.</p>
            </div>
        {% endfor %}
    </div>
{% endblock %}
```

**Explica√ß√£o:**

  * `{{ produto.imagem.url }}`:
      * Se `produto.imagem` existe, esta vari√°vel fornece a URL completa para a imagem carregada. 
      * O Django, com as configura√ß√µes que fizemos, saber√° como servir essa imagem a partir do `MEDIA_ROOT`.
      
  * `{% static 'img/default_product.png' %}`: 
      * Se um produto n√£o tiver imagem, podemos usar uma imagem padr√£o que √© um arquivo est√°tico.

### üß∞ Colocando em Pr√°tica: Passo a Passo

1. **Crie as Pastas:** Certifique-se de que sua estrutura de pastas `static/css`, `/static/js` e `static/img` existe.

1. **Crie Arquivos de Exemplo:**

      * Crie **`static/css/style.css`** com algum CSS simples:
      
        ```css
        /* style.css - Aula 10*/
        body {
            background-color: #f8f9fa;
        }
        .card {
            border: 1px solid #ddd;
            box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
        }
        ```
      * Crie **`static/js/script.js`** com um **`console.log`**:
      
        ```javascript
        // script.js - Aula 10
        console.log("Seu JavaScript personalizado est√° funcionando!");
        ```
      * Adicione uma imagem de exemplo em `static/img/logo.png`.
      
      
1. **Atualize `settings.py`:** 
    -  Adicione as configura√ß√µes de `STATIC_URL`, `STATICFILES_DIRS`, `MEDIA_URL` e `MEDIA_ROOT` como descrito.

1. **Atualize `core/urls.py`:** 
    - Adicione as linhas para servir arquivos de m√≠dia em desenvolvimento.
    
1. **Crie `site_loja/templates/site_loja/base.html`:** 
    - Copie o c√≥digo do template base.
    
1. **Atualize `site_loja/templates/site_loja/home.html` e `listar_produtos.html`:** 
    - Fa√ßa com que eles herdem do `base.html` e usem a tag `{% static %}` para suas imagens est√°ticas.


1. **Verifique no Navegador:**
      * Abra `http://127.0.0.1:8000/`.
      * Inspecione a p√°gina (Ctrl+Shift+I ou F12) e verifique na aba "Network" se os arquivos CSS, JS e as imagens est√°ticas e de m√≠dia est√£o sendo carregados corretamente. 
      * Voc√™ deve ver URLs como `/static/css/style.css` e `/media/produtos/sua_imagem.jpg`.


### Conclus√£o

Finalizamos o processo de implementar o gerenciamento de **arquivos est√°ticos** e **arquivos de m√≠dia**, al√©m de come√ßar a usar o poderoso conceito de **blocos** em templates.

Essa organiza√ß√£o n√£o s√≥ deixa seu c√≥digo mais limpo e eficiente, mas tamb√©m prepara seu projeto para futuras expans√µes e para a fase de produ√ß√£o. 

Lembre-se que as configura√ß√µes de `MEDIA_URL` no `urls.py` s√£o apenas para desenvolvimento. Quando for para produ√ß√£o, voc√™ configurar√° seu servidor web (Nginx, Apache) para lidar com isso de forma otimizada.

