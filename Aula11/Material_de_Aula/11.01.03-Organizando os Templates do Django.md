## 11.01.03 : Organizando os Templates do Django

Um jeito prático para se ter um código limpo e fácil de manter é **organizar seus templates**. Este material demonstrará, passo a passo, como fazer isso, mesmo que  nunca tenha ouvido falar em "separar conteúdo de templates" antes.

### :one: Por que organizar templates?

Imagine que você tem uma loja virtual e precisa que o **cabeçalho** (com o logo da loja e os links de navegação) e o **rodapé** (com informações de contato e direitos autorais) apareçam em *todas* as páginas do seu site. 

Se você copiar e colar o código do cabeçalho e do rodapé em cada um dos seus templates (página inicial, página de produtos, página de contato, etc.), o que acontece se você precisar mudar o número de telefone no rodapé? Você teria que alterar em *todas* as páginas\! Isso é ineficiente e propenso a erros.

**Organizar templates significa criar blocos de código reutilizáveis**. Assim, você define o cabeçalho e o rodapé uma única vez, e eles **são "herdados"** por todas as outras páginas. As vantagens são claras:

  * **Reutilização de código:** Escreva uma vez, use em muitos lugares.
  * **Manutenção fácil:** Mude em um lugar, atualize em todos.
  * **Organização:** Seu projeto fica mais limpo e fácil de entender.
  * **Colaboração:** Facilita o trabalho em equipe, já que cada um pode focar em uma parte específica.

### :two: Estrutura de Pastas de Templates

Para o Django encontrar seus templates, precisamos criar uma estrutura de pastas específica. Em um projeto Django, o mais comum é ter uma pasta **`templates`** na raiz do seu projeto (**`core`**, no seu caso) e, dentro dela, subpastas para cada aplicação.

Vamos criar essa estrutura:

```
core/
├── core/
├── produtos/
│   └── templates/
│       └── produtos/
│           └── (seus templates de produtos aqui)
├── site_loja/
│   └── templates/
│       └── site_loja/
│           └── (seus templates do site aqui)
├── templates/  <-- CRIE ESTA PASTA
│   ├── base.html  <-- CRIE ESTE ARQUIVO
│   ├── includes/  <-- CRIE ESTA PASTA
│   │   ├── header.html  <-- CRIE ESTE ARQUIVO
│   │   └── footer.html  <-- CRIE ESTE ARQUIVO
├── manage.py
└── (outros arquivos e pastas)
```

**Explicação da estrutura:**

  * **`core/templates/`**: 
      - Esta é a pasta principal para templates que serão **compartilhados** entre todas as suas aplicações. 
      - É aqui que colocaremos o template **base** do seu site e os "includes" (partes que se repetem, como cabeçalho e rodapé).
      
  * **`produtos/templates/produtos/`**: 
    - Esta pasta conterá os templates específicos da sua aplicação `produtos`.
    
  * **`site_loja/templates/site_loja/`**: 
      - Similarmente, esta pasta conterá os templates específicos da sua aplicação `site_loja`.

### :three: Configurando o Django para Encontrar Seus Templates

Agora que criamos as pastas, precisamos avisar o Django onde elas estão. Abra o arquivo **`core/settings.py`** (o arquivo de configurações principal do seu projeto) e encontre a seção **`TEMPLATES`**.

Dentro do dicionário **`DIRS`**, adicione o caminho para a sua pasta **`core/templates/`**. Deverá ficar assim:

```python
# core/settings.py

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [BASE_DIR / 'templates'], # <-- Adicione esta linha
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]
```

🧰 **O que fizemos aqui?**

  * `BASE_DIR`: 
      - É uma variável que aponta para a raiz do seu projeto (a pasta `core/` onde `manage.py` está).
        
  * **`BASE_DIR / 'templates'`**: 
      - Isso diz ao Django para procurar templates na pasta `templates` que está na raiz do seu projeto.
      
  * **`'APP_DIRS': True`**: 
      - Esta configuração já está ativada por padrão e diz ao Django para também procurar templates dentro das pastas `templates` de cada aplicação (por exemplo, `produtos/templates/` e `site_loja/templates/`).

Com essa configuração, o Django saberá onde buscar seus **templates**, tanto os compartilhados quanto os específicos de cada aplicação.



### :four: Criando o Template Base (`base.html`)

O arquivo **`base.html`** será o esqueleto do seu site. Ele conterá o código **HTML** comum a todas as páginas, como a estrutura básica, links para CSS do **Bootstrap**, e os blocos onde o conteúdo específico de cada página será inserido.

Abra o arquivo **`core/templates/base.html`** e adicione o seguinte código:

```html
{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Minha Loja Online{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    {% include 'includes/header.html' %}

    <main class="container mt-4">
        {% block content %}
        {% endblock %}
    </main>

    {% include 'includes/footer.html' %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    {% block extra_js %}
    {% endblock %}
</body>
</html>
```

🧰 **Vamos entender o que cada parte significa:**

  * **`{% load static %}`**: 
      - Esta linha é essencial para o Django encontrar seus arquivos estáticos (CSS, JavaScript, imagens). 
      - Certifique-se de que você configurou `STATIC_URL` e `STATICFILES_DIRS` em `settings.py` e rodou `python manage.py collectstatic` se estiver em produção. 
      - Para fins de desenvolvimento, o Django já consegue servir arquivos estáticos automaticamente.
      
  * **`<title>{% block title %}Minha Loja Online{% endblock %}</title>`**: 
      - Esta é uma **tag de bloco** do Django. O `block title` define um espaço onde as páginas que herdam deste template podem inserir um título específico. 
      - Se a página que herda não definir um título, "Minha Loja Online" será o padrão.
      
  * **`<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" ...>`**: 
      - Inclui o CSS do Bootstrap 5.3 diretamente de um CDN (Content Delivery Network).
      
  * **`<link rel="stylesheet" href="{% static 'css/style.css' %}">`**: 
    - Um exemplo de como incluir um arquivo CSS próprio, que você poderia criar em **`static/css/style.css`** na raiz do seu projeto.
    
  * **`{% include 'includes/header.html' %}`**: 
      - Esta é uma **tag de inclusão**. 
      - Ela vai inserir o conteúdo do arquivo **`header.html`** (que vamos criar a seguir) neste ponto.
      
  * **`{% block content %}{% endblock %}`**: 
    - Este é o bloco mais importante. 
    - É aqui que o conteúdo principal de cada página individual será renderizado.
    
  * **`{% include 'includes/footer.html' %}`**: 
      - Similar ao cabeçalho, inclui o conteúdo do **`footer.html`**.
      
      
  * **`{% block extra_js %}{% endblock %}`**: 
      - Outro bloco para permitir que páginas específicas adicionem seus próprios scripts JavaScript.



### :five: Criando os Arquivos de Inclusão (`header.html` e `footer.html`)

Agora, vamos criar os arquivos **`header.html`** e **`footer.html`** dentro da pasta **`core/templates/includes/`**.

#### 📁 **`core/templates/includes/header.html`**

```html
<header class="bg-dark text-white py-3">
    <div class="container d-flex justify-content-between align-items-center">
        <a href="/" class="text-white text-decoration-none h4 mb-0">Minha Loja</a>
        <nav>
            <ul class="nav">
                <li class="nav-item"><a href="/" class="nav-link text-white">Início</a></li>
                <li class="nav-item"><a href="/produtos/" class="nav-link text-white">Produtos</a></li>
                <li class="nav-item"><a href="/contato/" class="nav-link text-white">Contato</a></li>
                </ul>
        </nav>
    </div>
</header>
```

#### 📁 **`core/templates/includes/footer.html`**

```html
<footer class="bg-dark text-white py-4 mt-5">
    <div class="container text-center">
        <p>&copy; 2025 Minha Loja Online. Todos os direitos reservados.</p>
        <ul class="list-inline">
            <li class="list-inline-item"><a href="#" class="text-white text-decoration-none">Política de Privacidade</a></li>
            <li class="list-inline-item"><a href="#" class="text-white text-decoration-none">Termos de Serviço</a></li>
        </ul>
    </div>
</footer>
```

### :six: Adaptando os Templates das Aplicações (**`site_loja`** e **`produtos`**)

Agora que temos nosso template base e os includes, vamos modificar os templates das suas aplicações para que eles herdem do **`base.html`**.

Vamos supor que você tenha um template chamado **`home.html`** em **`site_loja/templates/site_loja/`** e um template **`lista_produtos.html`** em **`produtos/templates/produtos/`**.

#### 📁 Exemplo: **`site_loja/templates/site_loja/home.html`**

Modifique seu **`home.html`** para algo como isto:

```html
{% extends 'base.html' %}

{% block title %}Página Inicial - Minha Loja{% endblock %}

{% block content %}
<div class="p-5 mb-4 bg-light rounded-3">
    <div class="container-fluid py-5">
        <h1 class="display-5 fw-bold">Bem-vindo(a) à Nossa Loja!</h1>
        <p class="col-md-8 fs-4">Descubra os melhores produtos com os melhores preços. Qualidade e variedade para você!</p>
        <a href="/produtos/" class="btn btn-primary btn-lg" type="button">Ver Produtos</a>
    </div>
</div>

<h2>Produtos em Destaque</h2>
<div class="row">
    <div class="col-md-4">
        <div class="card mb-4 shadow-sm">
            <img src="https://via.placeholder.com/300x200" class="card-img-top" alt="Produto 1">
            <div class="card-body">
                <h5 class="card-title">Nome do Produto 1</h5>
                <p class="card-text">Descrição breve do produto 1.</p>
                <div class="d-flex justify-content-between align-items-center">
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-outline-secondary">Ver Detalhes</button>
                    </div>
                    <small class="text-muted">R$ 99,90</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card mb-4 shadow-sm">
            <img src="https://via.placeholder.com/300x200" class="card-img-top" alt="Produto 2">
            <div class="card-body">
                <h5 class="card-title">Nome do Produto 2</h5>
                <p class="card-text">Descrição breve do produto 2.</p>
                <div class="d-flex justify-content-between align-items-center">
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-outline-secondary">Ver Detalhes</button>
                    </div>
                    <small class="text-muted">R$ 149,90</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card mb-4 shadow-sm">
            <img src="https://via.placeholder.com/300x200" class="card-img-top" alt="Produto 3">
            <div class="card-body">
                <h5 class="card-title">Nome do Produto 3</h5>
                <p class="card-text">Descrição breve do produto 3.</p>
                <div class="d-flex justify-content-between align-items-center">
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-outline-secondary">Ver Detalhes</button>
                    </div> 
                    <small class="text-muted">R$ 79,90</small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

**Principais mudanças:**

  * **`{% extends 'base.html' %}`**: 
      - Esta é a linha mágica\! Ela diz ao Django que este template `home.html` vai **herdar** tudo o que está em `base.html`.
      
  * **`{% block title %}Página Inicial - Minha Loja{% endblock %}`**:
      - Aqui, estamos sobrescrevendo o bloco `title` definido em `base.html` para dar um título específico a esta página.
      
  * **`{% block content %}`...`{% endblock %}`**: 
      - Todo o conteúdo específico da sua página inicial deve ir dentro deste bloco. 
      - O que estiver fora desses blocos será ignorado, pois o Django só se importa com o que está nos blocos definidos no template pai.

#### 📁 Exemplo: **`produtos/templates/produtos/lista_produtos.html`**

```html
{% extends 'base.html' %}

{% block title %}Nossos Produtos - Minha Loja{% endblock %}

{% block content %}
<h1 class="mb-4">Todos os Nossos Produtos</h1>

<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card shadow-sm">
            <img src="https://via.placeholder.com/300x200" class="card-img-top" alt="Produto A">
            <div class="card-body">
                <h5 class="card-title">Produto A</h5>
                <p class="card-text">Uma breve descrição do Produto A.</p>
                <div class="d-flex justify-content-between align-items-center">
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-outline-secondary">Detalhes</button>
                    </div>
                    <small class="text-muted">R$ 120,00</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4 mb-4">
        <div class="card shadow-sm">
            <img src="https://via.placeholder.com/300x200" class="card-img-top" alt="Produto B">
            <div class="card-body">
                <h5 class="card-title">Produto B</h5>
                <p class="card-text">Uma breve descrição do Produto B.</p>
                <div class="d-flex justify-content-between align-items-center">
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-outline-secondary">Detalhes</button>
                    </div>
                    <small class="text-muted">R$ 85,50</small>
                </div>
            </div>
        </div>
    </div>
    </div>
{% endblock %}
```

A lógica é a mesma: estender **`base.html`** e preencher os blocos **`title`** e **`content`**.

### :seven: Dicas Adicionais para Organização de Templates

  * **Subpastas em `includes/`:** 
      - Se seus "includes" ficarem muito numerosos, você pode criar subpastas dentro de `core/templates/includes/` para organizá-los melhor (ex: `includes/navbars/`, `includes/forms/`).
      
  * **Context Processors:** 
      - Para dados que precisam estar disponíveis em *todos* ou na maioria dos seus templates (como o nome da loja, categorias de produtos globais), considere usar **context processors**. 
      - Eles injetam variáveis no contexto de todos os templates, evitando que você precise passá-las manualmente em cada view.
      
  * **Tags e Filtros Customizados:** 
      - Para lógicas de apresentação mais complexas que se repetem, você pode criar suas próprias **tags e filtros de template customizados** em suas aplicações.
      
  * **Static Files:** 
      - Não se esqueça de configurar a forma como o Django lida com arquivos estáticos (CSS, JS, imagens). 
      - Em `settings.py`, você deve ter `STATIC_URL` definido. Para arquivos estáticos específicos de uma aplicação, coloque-os em `sua_app/static/sua_app/`. 
      - Para arquivos estáticos globais do projeto, você pode criar uma pasta `static/` na raiz do projeto e adicionar seu caminho a `STATICFILES_DIRS` em `settings.py`.

