# 11.02.02 : Django ORM - Sqlite

### üõ†Ô∏è M√£o na Massa: projeto de exemplo

Vamos aplicar esses conceitos √† nossa estrutura de projeto com o `core` (projeto), `products` (aplica√ß√£o) e `site` (aplica√ß√£o).

#### üß™ Passo 1: Configurando o Banco de Dados em **`core/settings.py`**

Dentro do arquivo **`core/settings.py`**, voc√™ encontrar√° uma se√ß√£o chamada **`DATABASES`**. Por padr√£o, o Django vem configurado para usar o **SQLite**.

```python
# core/settings.py

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}
```

  * **Por que SQLite?** 
    - √â um banco de dados baseado em um √∫nico arquivo (`db.sqlite3`). N√£o requer um servidor separado, sendo perfeito para desenvolvimento e projetos pequenos.

Quando voc√™ for para produ√ß√£o, provavelmente usar√° o **`PostgreSQL`**. A configura√ß√£o seria assim:

```python
# core/settings.py - Exemplo para PostgreSQL

# DATABASES = {
#     'default': {
#         'ENGINE': 'django.db.backends.postgresql',
#         'NAME': 'nome_do_banco',      # O nome do seu banco de dados
#         'USER': 'usuario_do_banco',   # Seu usu√°rio no PostgreSQL
#         'PASSWORD': 'sua_senha',
#         'HOST': 'localhost',          # Ou o endere√ßo do servidor de banco de dados
#         'PORT': '5432',               # Porta padr√£o do PostgreSQL
#     }
# }
```

#### üß™ Passo 2: Criando os Modelos em **`products/models.py`** e **`site/models.py`**

Agora, vamos definir a estrutura dos nossos dados usando classes Python.

Na nossa aplica√ß√£o **`products`**, queremos guardar informa√ß√µes sobre categorias e produtos.

```python
# products/models.py

from django.db import models

##
# Modelo - Categoria (Aula 11.02.02)
##
class Category(models.Model):
    name = models.CharField(max_length=100, verbose_name="Nome da Categoria")
    
    def __str__(self):
        return self.name

##
# Modelo - Produto
##
class Product(models.Model):
    nome = models.CharField(max_length=200, verbose_name="Nome")
    descricao = models.TextField(verbose_name="Descri√ß√£o")
    preco = models.DecimalField(max_digits=10, decimal_places=2, verbose_name="Pre√ßo")
    estoque = models.PositiveIntegerField(default=0, verbose_name="Estoque")
    disponivel = models.BooleanField(default=True)
    imagem = models.ImageField(upload_to='produtos/', blank=True, null=True)

    # Campos de data
    data_criacao = models.DateTimeField(auto_now_add=True)
    data_atualizacao = models.DateTimeField(auto_now=True)
    
    # Aqui est√° a rela√ß√£o! Cada produto pertence a uma categoria. (Aula 11.02.02)
    category = models.ForeignKey(
        Category,
        on_delete=models.CASCADE,
        null=True,  # <-- Permite que o valor no banco de dados seja NULO
        blank=True, # <-- Permite que o campo no admin/formul√°rios fique em branco 
        related_name="products")

    def __str__(self):
        return self.name
```

* `CharField`, `TextField`, `DecimalField` 
- s√£o **tipos de campo** que o Django traduzir√° para os tipos de coluna correspondentes no banco de dados (ex: `VARCHAR`, `TEXT`, `DECIMAL`).

* `ForeignKey` 
- cria a **rela√ß√£o** entre `Product` e `Category`.

Na nossa aplica√ß√£o `site`, podemos ter um modelo para formul√°rios de contato.

```python
# site/models.py

from django.db import models

##
# Modelo - Contatos (Aula 11.02.02)
##
class ContactRequest(models.Model):
    nome = models.CharField(max_length=150, verbose_name="Nome")
    email = models.EmailField(verbose_name="E-mail")
    mensagem = models.TextField(verbose_name="Mensagem")
    
    # Campos de data
    data_criacao = models.DateTimeField(auto_now_add=True)
    
    data_atualizacao = models.DateTimeField(auto_now=True, 
                    verbose_name="Enviado em")
    
    def __str__(self):
        return f"Contato de {self.name} - {self.email}"
```

#### üß™ Passo 3: Migra√ß√µes (Migrations) - A Constru√ß√£o das Tabelas

Depois de definir seus modelos, voc√™ precisa dizer ao Django para criar o "plano de constru√ß√£o" (as migra√ß√µes) e depois executar esse plano no banco de dados.

1.  **Criar as migra√ß√µes:** Este comando l√™ seus **`models.py`** e cria os arquivos de instru√ß√£o.

    ```bash
    python manage.py makemigrations
    ```
    
2.  **Aplicar as migra√ß√µes:** Este comando executa as instru√ß√µes no banco de dados, criando as tabelas de fato.

    ```bash
    python manage.py migrate
    ```

Pronto\! Suas tabelas **`products_category`**, **`products_product`** e **`site_contactrequest`** agora existem no seu banco de dados, seja ele SQLite ou PostgreSQL.

