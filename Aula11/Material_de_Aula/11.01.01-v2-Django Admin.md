# 11.01.01 : Django Admin

> O objetivo deste material √©apresentar a interface de administra√ß√£o do Django, que simlifica o gerenciamento de dados do seu projeto. 

## üöÄ O que √© o Django Admin?

O **Django Admin** √© uma das funcionalidades mais poderosas e convenientes do framework Django. Ele gera automaticamente uma interface de **administra√ß√£o** para seus **modelos**, permitindo que voc√™ **visualize, adicione, edite e exclua dados** do seu banco de dados sem precisar escrever c√≥digo HTML ou formul√°rios complexos. √â uma ferramenta essencial para o gerenciamento de conte√∫do e dados do seu aplicativo.

Pense nele como um **painel de controle pronto** para usar, que o Django configura para voc√™ automaticamente assim que voc√™ define seus modelos (as estruturas de dados do seu projeto).

## üìù Configurando o Django Admin

Para que o **Django Admin** funcione, precisamos garantir que ele esteja configurado corretamente no seu projeto. 

### :one: Verificando as Aplica√ß√µes Instaladas

O **Django Admin** √© uma aplica√ß√£o  como qualquer outra, ou seja ela precisa estar listada em **`INSTALLED_APPS`** no seu arquivo **`settings.py`**.

Abra o arquivo **`core/settings.py`** e verifique a se√ß√£o **`INSTALLED_APPS`**. Voc√™ deve ver algo parecido com isto:

```python
# core/settings.py

INSTALLED_APPS = [
    'django.contrib.admin', # <-- Essa linha √© crucial!
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'produtos',   # Aplica√ß√£o de produtos
    'site_loja',  # Aplica√ß√£o do site da loja
]
```

Se **`django.contrib.admin`** estiver presente, est√° tudo certo\! Caso contr√°rio, adicione-o.

### :two:  Sincronizando o Banco de Dados

Sempre que voc√™ faz altera√ß√µes nos seus modelos ou instala novas aplica√ß√µes, √© importante rodar as migra√ß√µes para que o Django crie ou atualize as tabelas no seu banco de dados. O Django Admin tamb√©m precisa de suas pr√≥prias tabelas para funcionar.

Abra o seu terminal na raiz do projeto (`core`) e execute o seguinte comando:

```bash
python manage.py makemigrations
python manage.py migrate
```

  - `python manage.py makemigrations`: 
      - Este comando cria os arquivos de migra√ß√£o para suas aplica√ß√µes (e tamb√©m para as aplica√ß√µes internas do Django, como o Admin), traduzindo as mudan√ßas nos seus modelos para instru√ß√µes que o banco de dados entende.
  
  - `python manage.py migrate`: 
      - Este comando aplica as migra√ß√µes ao seu banco de dados, criando as tabelas necess√°rias e fazendo as altera√ß√µes.

### :three: Criando um Superusu√°rio

Para acessar o painel de administra√ß√£o, voc√™ precisa de um usu√°rio com permiss√µes de administrador, conhecido como **superusu√°rio**.

No terminal, execute o seguinte comando:

```bash
python manage.py createsuperuser
```

O Django pedir√° algumas informa√ß√µes:

  - **Username (deixe em branco para 'seu\_nome\_de\_usuario'):** 
      - Escolha um nome de usu√°rio. 
      - Por exemplo, `admin`.
     
  - **Email address:** 
      - Um endere√ßo de e-mail (opcional, mas recomendado). 
      - Por exemplo, `admin@exemplo.com`.
      
  - **Password:** 
      - Digite uma senha. 
      - Note que a senha n√£o aparecer√° enquanto voc√™ digita, por seguran√ßa.
      - 
  - **Password (again):** 
      - Digite a senha novamente para confirmar.

Se tudo correr bem, voc√™ ver√° uma mensagem confirmando que o superusu√°rio foi criado com sucesso.

## üéØ Acessando o Django Admin

Agora que configuramos tudo, √© hora de ver o Django Admin em a√ß√£o\!

### :one:  Iniciando o Servidor de Desenvolvimento

No seu terminal, certifique-se de que o servidor de desenvolvimento do Django esteja rodando:

```bash
python manage.py runserver
```

Voc√™ ver√° uma mensagem como: `Starting development server at http://127.0.0.1:8000/`.

### :two: Navegando para a Interface de Administra√ß√£o

Abra seu navegador e digite o seguinte endere√ßo:

```
http://127.0.0.1:8000/admin/
```

Voc√™ ser√° direcionado para uma tela de login. Use o nome de usu√°rio e a senha que voc√™ criou com o comando **`createsuperuser`**.

Ap√≥s fazer login, voc√™ ver√° o painel de administra√ß√£o do Django. Por padr√£o, ele exibir√° os modelos de usu√°rio e grupo (que fazem parte do sistema de autentica√ß√£o do Django).

## üìÑ Registrando Seus Modelos no Admin

Para que seus modelos de **`produtos`** e **`site_loja`** apare√ßam no painel de administra√ß√£o, voc√™ precisa registr√°-los. Isso √© feito no arquivo **`admin.py`** de cada aplica√ß√£o.

Vamos supor que sua aplica√ß√£o **`produtos`** tenha um modelo chamado **`Produto`** e a aplica√ß√£o **`site_loja`** tenha um modelo **`Categoria`** e **`Pagina`**.

### :one: Registrando o Modelo **`Produto**` na Aplica√ß√£o **`produtos`**

Abra o arquivo **`produtos/admin.py`** (se n√£o existir, crie-o) e adicione o seguinte c√≥digo:

```python
# produtos/admin.py

from django.contrib import admin
from .models import Produto # <-- Importa o modelo Produto da sua aplica√ß√£o

# Registra o modelo Produto
admin.site.register(Produto)
```

### :two: Registrando os Modelos `Categoria` e `Pagina` na Aplica√ß√£o `site_loja`

Agora, abra o arquivo `site_loja/admin.py` (crie-o se n√£o existir) e adicione:

```python
# site_loja/admin.py

from django.contrib import admin
from .models import Perfil

admin.site.register(Perfil)
```

üåü **Importante:** 
- Se voc√™ registrou novos modelos, pode ser necess√°rio reiniciar o servidor de desenvolvimento (`Ctrl+C` no terminal e depois `python manage.py runserver` novamente) para que as altera√ß√µes apare√ßam no Admin.

Ap√≥s reiniciar o servidor e recarregar a p√°gina do Django Admin, voc√™ ver√° suas aplica√ß√µes `Produtos` e `Site Loja` listadas, e dentro delas, os modelos que voc√™ registrou.

## üìò Explorando a Interface do Django Admin

Agora que seus modelos est√£o vis√≠veis, vamos ver o que voc√™ pode fazer.

### üß© Vis√£o Geral da P√°gina Principal

Na p√°gina principal do Admin, voc√™ ver√° uma lista de suas aplica√ß√µes e, abaixo de cada uma, os modelos que voc√™ registrou.

![dj 001](img/dj-001.png)

  - Clique em um modelo (por exemplo, **Produtos**).

### üß© P√°gina de Lista de Objetos

Ao clicar em um modelo, voc√™ ser√° levado para a p√°gina de lista de objetos desse modelo. Aqui voc√™ pode:

  - **Adicionar um novo objeto:** 
      - Clique no bot√£o "ADICIONAR [Seu Modelo]" (por exemplo, "ADICIONAR PRODUTO") no canto superior direito.
      
  - **Editar um objeto existente:** 
      - Clique no nome de qualquer objeto na lista.
      
  - **Excluir objetos:** 
      - Marque as caixas de sele√ß√£o ao lado dos objetos que deseja excluir, selecione a a√ß√£o "Excluir os itens selecionados" no menu suspenso "A√ß√£o" e clique em "Ir".
      
  - **Pesquisar:** 
      - Use a barra de pesquisa para encontrar objetos espec√≠ficos.
      
  - **Filtrar:** 
      - Se voc√™ configurou filtros em seu `ModelAdmin` (veremos isso a seguir), eles aparecer√£o na barra lateral direita.
      
  - **Ordenar:** 
      - Clique nos cabe√ßalhos das colunas para ordenar a lista.

### üß© P√°gina de Edi√ß√£o de Objeto

Ao adicionar um novo objeto ou editar um existente, voc√™ ver√° um formul√°rio. O Django gera automaticamente este formul√°rio com base nos campos definidos no seu modelo.

  - Preencha os campos.
  - **Salve:**
      - **Salvar e adicionar outro:** Salva o objeto atual e abre um novo formul√°rio de cria√ß√£o.
      - **Salvar e continuar editando:** Salva as altera√ß√µes e mant√©m voc√™ na mesma p√°gina de edi√ß√£o.
      - **Salvar:** Salva as altera√ß√µes e retorna para a p√°gina de lista de objetos.
  - **Excluir:** H√° um bot√£o "Excluir" no canto inferior esquerdo para remover o objeto.


## Atualizando o modelo **`Produto`**

Realize os ajustes necess√°rios para que arquivo **`produtos\models.py`** contenha as seguintes linhas:

```python
# produtos/models.py 
from django.db import models


##
# Aula 11 - 11.01.01
##
class Produto(models.Model):
    nome = models.CharField(max_length=100)
    descricao = models.TextField()
    preco = models.DecimalField(max_digits=10, decimal_places=2)
    estoque = models.PositiveIntegerField(default=0) # Campo para a quantidade em estoque
    disponivel = models.BooleanField(default=True) # Campo para indicar se o produto est√° dispon√≠vel para venda
    imagem = models.ImageField(upload_to='produtos/', blank=True, null=True) # Campo para imagem

    # Campos de data para registro de cria√ß√£o e √∫ltima atualiza√ß√£o
    data_criacao = models.DateTimeField(auto_now_add=True)
    data_atualizacao = models.DateTimeField(auto_now=True)

    class Meta:
        # Define a ordem padr√£o dos produtos por nome
        ordering = ['nome']

    def __str__(self):
        return self.nome
```

Realize o processo de migra√ß√£o do modelo para o banco de dados.

```bash
python .\manage.py makemigrations
```

o Django far√° uma pergunta sobre os campos `data_criacao` e `data_atualizacao` (e `estoque`, `disponivel` se eles tamb√©m forem novos para voc√™ e sua tabela j√° tiver dados).

Voc√™ ver√° algo parecido com isto:

```
You are trying to add a non-nullable field 'data_criacao' to produto without a default;
values must be provided.
Please select a fix:
 1) Provide a one-off default now (will be set on all existing rows)
 2) Quit, and let me add a default in models.py
Select an option:
```

üéØ **Escolha a op√ß√£o `1`** e pressione Enter.

O Django ent√£o perguntar√° qual valor padr√£o voc√™ quer usar. Para `data_criacao` e `data_atualizacao`, a melhor op√ß√£o √© usar o hor√°rio atual.

```
Please enter the default value now:
>>> timezone.now
```

**Importante:** Digite **`django.utils.timezone.now`** (sem aspas) e pressione Enter.

  * Se voc√™ n√£o estiver usando fusos hor√°rios no seu projeto Django, ou se n√£o importou `timezone` para o seu `models.py` (o que n√£o √© necess√°rio para esta resposta), voc√™ tamb√©m poderia usar `datetime.datetime.now` (voc√™ precisaria importar `datetime` no console do `makemigrations` se ele perguntar). No entanto, **`timezone.now` √© a forma recomendada pelo Django**.

O Django ent√£o criar√° o arquivo de migra√ß√£o para o seu modelo `Produto`.

üéØ  **Aplique as migra√ß√µes:**

```bash
python manage.py migrate
```

Este comando ir√° aplicar as mudan√ßas ao seu banco de dados, criando as novas colunas e preenchendo as linhas existentes com o valor padr√£o que voc√™ especificou (`django.utils.timezone.now`).


## üë®‚Äçüíª Personalizando o Django Admin com `ModelAdmin`

O **Django Admin** √© muito flex√≠vel e voc√™ pode personaliz√°-lo para atender √†s suas necessidades. Isso √© feito criando uma classe **`ModelAdmin`** para cada modelo que voc√™ quer personalizar.

Vamos melhorar a exibi√ß√£o do modelo **`Produto`** na sua aplica√ß√£o **`produtos`**.

Abra **`produtos/admin.py`** novamente e modifique-o para algo assim:

```python
# produtos/admin.py

from django.contrib import admin
from .models import Produto

# Define uma classe ModelAdmin para o modelo Produto
class ProdutoAdmin(admin.ModelAdmin):
    # Campos que ser√£o exibidos na p√°gina de lista de objetos
    list_display = ('nome', 'preco', 'estoque', 'disponivel')
    
    # Campos que podem ser clicados para ordenar a lista
    list_display_links = ('nome',)
    
    # Adiciona uma barra lateral de filtro para os campos
    list_filter = ('disponivel', 'data_criacao') # Supondo que voc√™ tenha um campo data_criacao
    
    # Adiciona uma barra de pesquisa
    search_fields = ('nome', 'descricao') # Pesquisa por nome ou descri√ß√£o
    
    # Permite editar campos diretamente na lista (cuidado com isso em produ√ß√£o!)
    list_editable = ('preco', 'estoque', 'disponivel')
    
    # Pre-popula o campo 'slug' (se voc√™ tiver um) baseado no 'nome'
    # prepopulated_fields = {'slug': ('nome',)}
    
    # Agrupa campos no formul√°rio de edi√ß√£o/cria√ß√£o
    fieldsets = (
        (None, {
            'fields': ('nome', 'descricao', 'preco', 'estoque', 'disponivel', 'imagem')
        }),
    )

# Registra o modelo Produto com a sua classe ModelAdmin personalizada
admin.site.register(Produto, ProdutoAdmin)
```

üß™ **Explica√ß√£o dos atributos `ModelAdmin`:**

  - **`list_display`**: 
      - Uma tupla ou lista de nomes de campos que ser√£o exibidos como colunas na p√°gina de lista de objetos do Admin.
      
  - **`list_display_links`**: 
      - Uma tupla ou lista de nomes de campos em `list_display` que se tornar√£o links para a p√°gina de edi√ß√£o do objeto.
      
  - **`list_filter`**: 
      - Uma tupla ou lista de nomes de campos que ser√£o usados para criar filtros na barra lateral direita da p√°gina de lista de objetos. 
      - √ötil para filtrar por status, datas, etc.
      
  - **`search_fields`**: 
      - Uma tupla ou lista de nomes de campos que o Admin usar√° para a funcionalidade de pesquisa. 
      - A pesquisa √© baseada em `LIKE` no banco de dados.
      
  - **`list_editable`**: 
      - Uma tupla ou lista de nomes de campos que podem ser editados diretamente na p√°gina de lista de objetos, sem precisar entrar na p√°gina de edi√ß√£o individual. Use com cautela\!
      
  - **`prepopulated_fields`**: 
      - Um dicion√°rio que mapeia campos `SlugField` para os campos dos quais eles devem ser preenchidos automaticamente no formul√°rio de edi√ß√£o/cria√ß√£o.
      
  - **`fieldsets`**: 
      - Uma lista de tuplas que define a ordem, o agrupamento e a apar√™ncia dos campos no formul√°rio de edi√ß√£o/cria√ß√£o. Cada tupla representa um "fieldset" (um grupo de campos).
      - A primeira parte da tupla √© o t√≠tulo do fieldset.
      - A segunda parte √© um dicion√°rio com chaves como `fields` (uma tupla ou lista de campos) e `classes` (uma tupla de classes CSS, como `'collapse'` para fazer o fieldset recolh√≠vel).

![dj 002](img/dj-002.png)

