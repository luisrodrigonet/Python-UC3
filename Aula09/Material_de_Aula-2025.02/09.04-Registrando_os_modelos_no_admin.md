## 09.04 Registrando Classes do Model no Django Admin

O painel de administra√ß√£o do Django (Admin Site) √© uma interface que l√™ metadados dos seus modelos para fornecer uma interface `CRUD` (**Create, Read, Update, Delete**) pronta para uso. Para que isso funcione, precisamos **explicitamente** dizer ao Django quais modelos ele deve expor.

Vamos utilizar os modelos da nossa aplica√ß√£o `receitas` (`Categoria` e `Receita`) como base.

### üìù Resumo da Solu√ß√£o Proposta

O registro √© feito editando o arquivo **`receitas/admin.py`**. Usaremos a sintaxe b√°sica de registro e, em seguida, demonstraremos o uso de `ModelAdmin` para personalizar a exibi√ß√£o das receitas.

### Passo 0: Aplicando as migra√ß√µes pendentes

Ap√≥s a cria√ß√£o ou altera√ß√µes dos seus modelos, voc√™ dever√° rodar as migra√ß√µes novamente:

```bash 
python manage.py makemigrations
python manage.py migrate
```

### Passo 1: Importando os Componentes Necess√°rios

Abra o arquivo **`receitas/admin.py`**. Precisamos importar o m√≥dulo `admin` do Django e os modelos que criamos.

```python
# receitas/admin.py

# 1. Importamos o m√≥dulo admin.
from django.contrib import admin

# 2. Importamos as classes de modelo que queremos registrar.
from .models import Categoria, Receita 

```

### Passo 2: O Registro B√°sico dos Modelos

A forma mais simples de registrar um modelo √© usando a fun√ß√£o `admin.site.register()`.

```python
# receitas/admin.py (Continua√ß√£o)

# Registro simples do modelo Categoria
admin.site.register(Categoria)

# Registro simples do modelo Receita
admin.site.register(Receita) 
```

Ap√≥s ajustar o arquivo devemos criar um usu√°rio com acesso a interface adminstrativa do django:

```bash 
python manage.py createsuperuser
```

Em seguida devemos iniciar o servidor: 

```bash 
python manage.py runserver
```

Ent√£o poderemos ver e gerenciar ambos os modelos em http://127.0.0.1:8000/admin/


### Passo 3: Personalizando a Exibi√ß√£o com `ModelAdmin` (opcional)

Embora o registro b√°sico funcione, ele oferece pouca informa√ß√£o. Quando acessamos a lista de receitas no painel, por padr√£o, o Django s√≥ exibe o m√©todo `__str__` do objeto. Para uma experi√™ncia de gerenciamento melhor, usamos a classe **`ModelAdmin`**.

A classe `ModelAdmin` permite configurar como o modelo aparece na listagem, formul√°rios de edi√ß√£o e detalhe.

```python
# receitas/admin.py (Continua√ß√£o)

@admin.register(Receita)
class ReceitaAdmin(admin.ModelAdmin):
    """
    Personaliza a interface de administra√ß√£o para o modelo Receita.
    """
    
    # 1. list_display: Campos que aparecer√£o na tabela de listagem do Admin.
    list_display = (
        'titulo', 
        'autor', 
        'tempo_preparo', 
        'publicada', 
        'data_publicacao'
    )
    
    # 2. list_filter: Cria uma barra lateral para filtrar os resultados.
    list_filter = (
        'publicada', 
        'autor', 
        'categorias', 
        'data_publicacao'
    )
    
    # 3. search_fields: Permite pesquisar por esses campos.
    search_fields = (
        'titulo', 
        'ingredientes', 
        'modo_preparo'
    )
    
    # 4. list_editable: Permite editar esses campos diretamente na lista.
    list_editable = (
        'publicada',
    )
    
    # 5. raw_id_fields: √ötil para ForeingKeys com muitos objetos (como 'autor'),
    #    substituindo o Select Box padr√£o por um campo de entrada de texto pesquis√°vel por ID.
    raw_id_fields = (
        'autor',
    )
    
# O modelo Categoria tamb√©m pode ser personalizado, mas usaremos a sintaxe b√°sica (Passo 2) 
# ou aprimoraremos a ReceitaAdmin para incluir as categorias.
```

> **Aten√ß√£o:** Neste exemplo, usamos o decorador **`@admin.register(Receita)`**, que √© o m√©todo recomendado e mais limpo para registrar modelos em vez de usar `admin.site.register(Receita, ReceitaAdmin)` separadamente.

-----

### üí° Observa√ß√µes Adicionais

#### Django Admin e `django-jazzmin` / `django-admin-adminlte`

O painel de administra√ß√£o padr√£o do Django √© funcional, mas tem um visual simples. Para dar um toque profissional e moderno, √© altamente recomend√°vel o uso de temas de terceiros:

  * **`django-jazzmin`:** Oferece um dashboard moderno e responsivo com muitas op√ß√µes de cores e layout.
  * **`django-admin-adminlte`:** Baseado no popular template AdminLTE, proporcionando uma interface elegante.

**Como Usar:** Depois de instalar (ex: `pip install django-jazzmin`), voc√™ simplesmente adiciona a biblioteca √† sua lista `INSTALLED_APPS` **acima** de `'django.contrib.admin'` no seu arquivo `settings.py`. Nenhuma altera√ß√£o no `admin.py` √© necess√°ria, o tema se aplica automaticamente\!

#### O Papel do `__str__`

√â **vital** que todos os seus modelos tenham definido o m√©todo m√°gico `__str__`.

```python
class Receita(models.Model):
    # ... campos
    def __str__(self):
        # O Admin usar√° o valor retornado aqui para representar o objeto.
        return self.titulo 
```

Se voc√™ n√£o o definir, o Admin exibir√° algo gen√©rico como `Receita object (1)`, o que √© in√∫til para identificar o objeto.

#### Campos ManyToMany no Admin

No nosso modelo `Receita`, o campo `categorias` √© um `ManyToManyField`. O Django Admin lida com isso automaticamente, criando um widget de sele√ß√£o m√∫ltipla.

Se voc√™ tiver muitas categorias, a experi√™ncia de usu√°rio pode ser ruim. √â aqui que o **`django-select2`** brilha:

1.  **Instale:** `pip install django-select2` e adicione a app.
2.  **Use em `admin.py`:** Sobrescreva o widget do campo.

<!-- end list -->

```python
# receitas/admin.py (Com django-select2)
from django.db import models
from django_select2.forms import Select2MultipleWidget
# ... imports ...

@admin.register(Receita)
class ReceitaAdmin(admin.ModelAdmin):
    # ... list_display, etc. ...
    
    # Sobrescreve o widget padr√£o do ManyToManyField
    formfield_overrides = {
        models.ManyToManyField: {'widget': Select2MultipleWidget},
    }
```

Isso transformar√° o campo de categorias em uma caixa de pesquisa poderosa e amig√°vel.

