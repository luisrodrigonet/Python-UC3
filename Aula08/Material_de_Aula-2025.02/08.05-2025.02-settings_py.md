# 08.05 - Configura√ß√£o do projeto (settings)

## üìù Arquivo `settings.py`:

O arquivo `settings.py` √© o cora√ß√£o da configura√ß√£o de um projeto Django, contendo **defini√ß√µes globais** como **aplicativos** instalados, configura√ß√µes de **banco de dados**, **middleware**, **templates**, configura√ß√µes de **seguran√ßa**, entre outros. Ele √© gerado automaticamente na pasta do projeto e segue um formato padr√£o, que pode ser personalizado conforme necess√°rio.

Abra o projeto em um editor de c√≥digo e acesse a pasta `config`,  analise o arquivo `settings.py` e identifique as configura√ß√µes padr√£o, como `INSTALLED_APPS` e `DATABASES`.
  
### üéØ Se√ß√£o INSTALLED_APPS

Especifica os aplicativos **Django** ativos no projeto. Cada aplicativo listado contribui com **modelos**, **views**, **templates** e outros recursos. 

A configura√ß√£o padr√£o inclui os aplicativos principais do Django, que fornecem funcionalidades essenciais.

**Configura√ß√£o Padr√£o** (em um projeto rec√©m-criado):
```python
INSTALLED_APPS = [
    'django.contrib.admin',          # Interface administrativa
    'django.contrib.auth',           # Sistema de autentica√ß√£o
    'django.contrib.contenttypes',   # Framework para tipos de conte√∫do
    'django.contrib.sessions',       # Gerenciamento de sess√µes
    'django.contrib.messages',       # Sistema de mensagens para o usu√°rio
    'django.contrib.staticfiles',    # Gerenciamento de arquivos est√°ticos
]
```

**An√°lise dos Componentes**:

- **`django.contrib.admin`**: 
    - Fornece a **interface administrativa** autom√°tica, acess√≠vel em `/admin/`, para gerenciar modelos.

- **`django.contrib.auth`**: 
    - Inclui modelos e funcionalidades para **autentica√ß√£o de usu√°rios** (ex.: `User`, `Group`, login/logout).

- **`django.contrib.contenttypes`**: 
    - Permite **associa√ß√µes** gen√©ricas **entre modelos**, usado por outros aplicativos como o admin.

- **`django.contrib.sessions`**: 
    - Habilita o suporte a **sess√µes**, permitindo **armazenar dados entre requisi√ß√µes**.

- **`django.contrib.messages`**: 
    - Fornece um sistema para exibir **mensagens tempor√°rias** (ex.: "Registro salvo com sucesso").
    
- **`django.contrib.staticfiles`**: 
    - Gerencia **arquivos est√°ticos** (CSS, JavaScript, imagens) usados em templates HTML5.

ü´µ **Observa√ß√£o**:
- Voc√™ pode adicionar aplicativos personalizados (ex.: `'posts'`) ou de terceiros (ex.: `'django_extensions'`) a essa lista.
- A ordem em `INSTALLED_APPS` pode afetar a prioridade de templates e arquivos est√°ticos.


### üéØ Se√ß√£o DATABASES

A configura√ß√£o `DATABASES` define os **bancos de dados** usados pelo projeto. Por padr√£o, o Django configura o SQLite, um banco leve e embutido, ideal para desenvolvimento inicial.

ü¶ñ **Configura√ß√£o Padr√£o**:
```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}
```

ü§ñ **An√°lise dos Componentes**:

- **`ENGINE`**: 
    - Especifica o **backend** do banco de dados. 
    - O valor `'django.db.backends.sqlite3'` indica o uso do SQLite.
    
- **`NAME`**: 
    - Define o **caminho para o arquivo** do banco de dados SQLite. 
    - O `BASE_DIR / 'db.sqlite3'` aponta para um arquivo `db.sqlite3` na raiz do projeto, gerado automaticamente.

- **Outras op√ß√µes** (n√£o presentes por padr√£o, mas configur√°veis):
  - Para bancos como PostgreSQL ou MySQL, voc√™ alteraria o `ENGINE` (ex.: `'django.db.backends.postgresql'`) e adicionaria chaves como `HOST`, `PORT`, `USER` e `PASSWORD`.

ü¶ñ **Exemplo de Configura√ß√£o para PostgreSQL** (n√£o padr√£o, mas comum em produ√ß√£o):
```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'meu_banco',
        'USER': 'meu_usuario',
        'PASSWORD': 'minha_senha',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}
```

### üéØ Outras Configura√ß√µes Relevantes

Para fornecer uma vis√£o mais completa, destacamos outras configura√ß√µes:

#### üîñ **`SECRET_KEY`**:
  ```python
  SECRET_KEY = 'django-insecure-algum_valor_aleatorio'
  ```
  - Uma chave usada para seguran√ßa criptogr√°fica. 
  - O prefixo `django-insecure-` indica que √© insegura para produ√ß√£o. 
  - Use `django-extensions` (`generate_secret_key`) para criar uma chave segura.
  

#### üîñ  **`DEBUG`**:
  ```python
  DEBUG = True
  ```
  - Ativado por padr√£o para desenvolvimento, exibe erros detalhados no navegador. 
  - Deve ser definido como `False` em produ√ß√£o.

#### üîñ  **`ALLOWED_HOSTS`**:

  ```python
  ALLOWED_HOSTS = []
  ```
  - Lista vazia por padr√£o, permitindo apenas `localhost` em desenvolvimento. 
  - Em produ√ß√£o, adicione dom√≠nios (ex.: `['meusite.com', 'www.meusite.com']`).

#### üîñ  **`MIDDLEWARE`**:

A finalidade da se√ß√£o `MIDDLEWARE` √© definir uma cadeia de componentes de baixo n√≠vel (os middlewares) que processam requisi√ß√µes HTTP antes que elas cheguem √† View do Django, e tamb√©m processam as respostas HTTP depois que a View as gera, mas antes que sejam enviadas de volta ao cliente.

Pense no MIDDLEWARE como um conjunto de filtros ou port√µes. Cada requisi√ß√£o precisa passar por esses port√µes em uma ordem espec√≠fica (de cima para baixo na lista), e cada resposta passa por eles na ordem inversa (de baixo para cima).

  ```python
  MIDDLEWARE = [
      'django.middleware.security.SecurityMiddleware',
      'django.contrib.sessions.middleware.SessionMiddleware',
      'django.middleware.common.CommonMiddleware',
      'django.middleware.csrf.CsrfViewMiddleware',
      'django.contrib.auth.middleware.AuthenticationMiddleware',
      'django.contrib.messages.middleware.MessageMiddleware',
      'django.middleware.clickjacking.XFrameOptionsMiddleware',
  ]
  ```
  
**Execu√ß√£o:**

1. **Requisi√ß√£o (Request)**: O servidor web recebe uma requisi√ß√£o. Essa requisi√ß√£o passa pelo SecurityMiddleware, depois pelo SessionMiddleware, e assim por diante, na ordem em que est√£o listados.

2. **View**: Ap√≥s passar por todos os middlewares de requisi√ß√£o, o Django finalmente chama a View correspondente.

3. **Resposta (Response)**: A View retorna uma resposta. Essa resposta passa de volta pelos middlewares, mas na ordem inversa (XFrameOptionsMiddleware, MessageMiddleware, etc.) antes de ser enviada ao cliente.

Define `middlewares` para processamento de requisi√ß√µes/respostas, como seguran√ßa, sess√µes e prote√ß√£o CSRF.
  


#### üîñ  **`TEMPLATES`**:

A principal finalidade da se√ß√£o `TEMPLATES` √© configurar o **sistema de template (modelo)** do Django. Ela informa ao framework:

1. Qual mecanismo de template utilizar (geralmente o backend nativo do Django).
2. Onde procurar pelos arquivos de template (HTML, etc.) no sistema de arquivos.
3. Quais processadores de contexto (context processors) devem estar dispon√≠veis para injetar vari√°veis globais em todos os templates.

Em resumo, √© o ponto de controle que gerencia como o Django deve renderizar o HTML din√¢mico que ser√° enviado ao navegador do usu√°rio.


üêç **Exemplo 01**:
  ```python
  TEMPLATES = [
      {
          'BACKEND': 'django.template.backends.django.DjangoTemplates',
          'DIRS': [],
          'APP_DIRS': True,
          'OPTIONS': {
              'context_processors': [
                  'django.template.context_processors.debug',
                  'django.template.context_processors.request',
                  'django.contrib.auth.context_processors.auth',
                  'django.contrib.messages.context_processors.messages',
              ],
          },
      },
  ]
  ```


üêç **Exemplo 02**:
```python
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [BASE_DIR / 'templates'], # <-- Onde buscar templates do projeto
        'APP_DIRS': True,                 # <-- Busca templates dentro de cada app
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
                # Outros Context Processors
            ],
        },
    },
]
```

  
- `BACKEND`
    - **Valor Padr√£o**: 'django.template.backends.django.DjangoTemplates'
    - **Descri√ß√£o**: Especifica o motor de template a ser usado. O valor padr√£o indica que o Django usar√° seu pr√≥prio sistema de templates, que √© compat√≠vel com HTML5 e permite a cria√ß√£o de templates din√¢micos com sintaxe como `{{ variavel }}` e `{% tag %}`.
   
- `DIRS`
    - **Valor Padr√£o**: `[]`
    - **Descri√ß√£o**: 
        - Lista de diret√≥rios onde o Django procurar√° templates fora dos aplicativos (ou seja, templates globais). 
        - Por padr√£o, est√° vazia, significando que o Django s√≥ busca templates nos diret√≥rios `templates/` de cada aplicativo listado em `INSTALLED_APPS`.
    - **Uso**:
        - Para adicionar templates globais (ex.: um template base para todo o projeto), adicione o caminho ao diret√≥rio:
            ```python
            'DIRS': [BASE_DIR / 'templates'],
            ```
    - **Exemplo**: Crie um diret√≥rio `templates/` na raiz do projeto e adicione um arquivo como `base.html` para ser usado como base em v√°rias p√°ginas.
        
    - **Integra√ß√£o com Bootstrap**: Um diret√≥rio global pode conter um template base com a estrutura do Bootstrap:
    
    ```html
    <!-- templates/base.html -->
    <!DOCTYPE html>
    <html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Meu Site{% endblock %}</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    </head>
    <body>
        <div class="container">
            {% block content %}{% endblock %}
        </div>
    </body>
    </html>
  ```
   
   
  - `APP_DIRS: True`:
    - Permite que templates sejam buscados nos diret√≥rios dos aplicativos.
    - **Valor Padr√£o**: `True`
    - **Descri√ß√£o**: 
        - Quando `True`, o Django procura automaticamente templates nos subdiret√≥rios `templates/` de cada aplicativo listado em `INSTALLED_APPS`. 
        - Por exemplo, se voc√™ tem um app chamado `posts`, o Django buscar√° templates em `posts/templates/`.
    - **Uso**:
        - Essa configura√ß√£o √© conveniente para organizar templates por aplicativo, mantendo a modularidade.
        - Para desativar essa busca autom√°tica (raro), defina como `False` e especifique todos os diret√≥rios em `DIRS`.
    - **Exemplo**: Em um app `posts`, crie `posts/templates/posts/home.html` para renderizar uma p√°gina espec√≠fica:
    ```html
    <!-- posts/templates/posts/home.html -->
    {% extends 'base.html' %}
    {% block content %}
        <h1 class="mt-5">Bem-vindo ao Blog</h1>
        <p class="lead">Conte√∫do din√¢mico aqui.</p>
    {% endblock %}
    ```
  

#### üîñ  Arquivos Est√°ticos

Esta se√ß√£o informa ao Django onde procurar arquivos est√°ticos de seus aplicativos e onde colet√°-los para produ√ß√£o.

##### :one: `STATIC_URL` (Obrigat√≥rio)

Define a URL base que ser√° usada para servir arquivos est√°ticos.

```python
# settings.py

# URL que ser√° usada ao referenciar arquivos est√°ticos no seu HTML.
# Exemplo: <link href="/static/css/style.css" ...>
STATIC_URL = 'static/' 
```

##### :two: `STATICFILES_DIRS` (Opcional, mas Recomendado)

Define uma lista de diret√≥rios **fora dos aplicativos** onde o Django deve procurar por arquivos est√°ticos. √â o local ideal para arquivos est√°ticos que s√£o compartilhados por todo o projeto (ex: logotipos, CSS global).

```python
# settings.py

import os
from pathlib import Path

# Certifique-se de que BASE_DIR est√° definido no topo do seu settings.py
BASE_DIR = Path(__file__).resolve().parent.parent 

# Lista de diret√≥rios DENTRO do seu projeto onde existem arquivos est√°ticos
STATICFILES_DIRS = [
    BASE_DIR / "static",
    # BASE_DIR / "outra_pasta_estatica",
]
```

##### :three: `STATIC_ROOT` (Somente Produ√ß√£o)

Define o **diret√≥rio √∫nico** onde o comando `python manage.py collectstatic` ir√° coletar **todos** os arquivos est√°ticos (de todos os apps, mais os de `STATICFILES_DIRS`).

Este diret√≥rio deve ser usado por seu servidor web de produ√ß√£o (Nginx, Apache) para servir os arquivos est√°ticos de forma eficiente. **N√£o o inclua em `STATICFILES_DIRS`\!**

```python
# settings.py

# O caminho absoluto para o diret√≥rio onde os arquivos est√°ticos ser√£o COLETADOS
# (Usado pelo 'collectstatic').
STATIC_ROOT = BASE_DIR / "staticfiles"
```

##### üîñ Arquivos de M√≠dia

Arquivos de m√≠dia s√£o aqueles enviados pelos usu√°rios (ex: fotos de perfil, uploads de documentos). Eles precisam de uma configura√ß√£o separada.

##### :one: `MEDIA_URL` (Obrigat√≥rio)

Define a URL base que ser√° usada para servir os arquivos de m√≠dia enviados pelos usu√°rios.

```python
# settings.py

# URL que ser√° usada ao referenciar arquivos de m√≠dia no seu HTML.
# Exemplo: <img src="/media/fotos/perfil.jpg" ...>
MEDIA_URL = 'media/'
```

##### :two: `MEDIA_ROOT` (Obrigat√≥rio)

Define o **caminho absoluto** no sistema de arquivos onde os arquivos de m√≠dia ser√£o armazenados no servidor.

```python
# settings.py

# O caminho absoluto para o diret√≥rio onde os arquivos de m√≠dia ser√£o armazenados
MEDIA_ROOT = BASE_DIR / "media"
```
  

##### üîñ  **`LANGUAGE_CODE` e `TIME_ZONE`**:

  ```python
  LANGUAGE_CODE = 'en-us'
  TIME_ZONE = 'UTC'
  ```
  - Configura idioma e fuso hor√°rio padr√£o. 
  Para projetos em portugu√™s, altere para `'pt-br'` e, por exemplo, `'America/Sao_Paulo'`.


## Servindo Arquivos de M√≠dia em Desenvolvimento (`urls.py`)

No modo de desenvolvimento (`DEBUG=True`), o Django **n√£o** serve arquivos de m√≠dia e est√°ticos automaticamente, exceto os do `STATIC_URL`. Voc√™ precisa adicionar rotas espec√≠ficas no seu `urls.py` principal para que o Django os sirva.

**Ajuste no `urls.py` principal:**

```python
# urls.py (do projeto principal)

from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),
    # ... suas rotas de app
]

# Apenas em modo de desenvolvimento (DEBUG=True)
if settings.DEBUG:
    # Configura√ß√£o para servir Static Files
    urlpatterns += static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)
    
    # Configura√ß√£o para servir Media Files (arquivos de usu√°rio)
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

**Nunca use esta configura√ß√£o de `static()` em produ√ß√£o**, pois isso √© ineficiente e inseguro. Em produ√ß√£o, deixe um servidor web dedicado (Nginx/Apache) lidar com `STATIC_ROOT` e `MEDIA_ROOT`.

